<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tone Persuasion Game</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;
        
        const TonePersuasionGame = () => {
          const [gameState, setGameState] = useState('intro');
          const [currentNPC, setCurrentNPC] = useState(null);
          const [currentNodes, setCurrentNodes] = useState({
            client: 'NODE_PC_01',
            intern: 'NODE_JP_01',
            colleague: 'NODE_SM_01',
            admin: 'NODE_RK_01'
          });
          const [conversations, setConversations] = useState({
            client: [],
            intern: [],
            colleague: [],
            admin: []
          });
          const [npcStatus, setNpcStatus] = useState({
            client: 'pending',
            intern: 'pending',
            colleague: 'pending',
            admin: 'pending'
          });
          const [npcRapport, setNpcRapport] = useState({
            client: 0,
            intern: 0,
            colleague: 0,
            admin: 0
          });
          const [pathsTaken, setPathsTaken] = useState({
            client: [],
            intern: [],
            colleague: [],
            admin: []
          });

          const npcs = {
            client: {
              name: "Ms. Patricia Chen",
              role: "Senior Client",
              task: "Approve the budget increase for additional resources",
              avatar: "ðŸ‘”",
              mbti: "ENTJ",
              projectGoal: "Wants the project to demonstrate clear ROI and enhance her company's reputation",
              selfishGoal: "Looking to use this project's success as leverage for a board position",
              flaw: "Becomes dismissive and cuts ties completely if she perceives incompetence or weakness",
              communicationStyle: "Expects confidence, directness, and data-driven arguments. Hates hedging language ('maybe', 'hopefully'). Respects boldness but not arrogance.",
              treeKey: 'client'
            },
            intern: {
              name: "James Park",
              role: "New Intern",
              task: "Prepare the data analysis report by Friday",
              avatar: "ðŸ˜Š",
              mbti: "ISFJ",
              projectGoal: "Wants to do excellent work that contributes meaningfully to the team",
              selfishGoal: "Desperately wants to prove himself worthy of a full-time offer after his internship",
              flaw: "Becomes paralyzed by harsh criticism or pressure, may freeze up completely and fail to deliver",
              communicationStyle: "Needs clear guidance, reassurance, and warmth. Responds well to collaborative language ('we', 'let's work on this together'). Shuts down with aggressive or cold tone.",
              treeKey: 'intern'
            },
            colleague: {
              name: "Dr. Sarah Martinez",
              role: "Senior Researcher",
              task: "Share her team's research findings for the presentation",
              avatar: "ðŸ”¬",
              mbti: "INTJ",
              projectGoal: "Wants the project to respect academic rigor and properly credit her team's contributions",
              selfishGoal: "Protecting her research from being oversimplified or misrepresented in the presentation",
              flaw: "Becomes territorial and actively obstructive if she feels her work is being disrespected or stolen",
              communicationStyle: "Values diplomatic, collaborative language. Sensitive to being ordered around or having her expertise questioned. Responds to appeals about shared goals and mutual respect.",
              treeKey: 'colleague'
            },
            admin: {
              name: "Mr. Robert Kim",
              role: "Department Administrator",
              task: "Fast-track the equipment approval process",
              avatar: "ðŸ“‹",
              mbti: "ISTJ",
              projectGoal: "Wants all processes to follow proper procedures and maintain institutional integrity",
              selfishGoal: "Avoiding any appearance of favoritism or rule-breaking that could reflect poorly on his department",
              flaw: "Becomes rigid and refuses all requests if proper protocols aren't followed or if pressured inappropriately",
              communicationStyle: "Requires formal, precise language with clear justification. Responds to policy-based arguments and proper channels. Ignores emotional appeals or attempts to bypass procedure.",
              treeKey: 'admin'
            }
          };

          // Conversation Trees Data
          const conversationTrees = {
            client: {
              'NODE_PC_01': {
                npcText: "You have five minutes. What's this about a budget increase?",
                status: 'pending',
                options: [
                  {
                    text: "Ms. Chen, we need $45K additional budget. Our analysis shows this investment will accelerate delivery by three weeks and increase projected ROI by 22%.",
                    tone: "Confident/Data-driven",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_02',
                    reasoning: "Direct, confident, leads with concrete numbers. Respects her time and speaks her language."
                  },
                  {
                    text: "Hey, so... we were hoping maybe you could help us out with some extra budget? We're running into a few issues and could really use the support.",
                    tone: "Casual/Uncertain",
                    rapportChange: -12,
                    nextNode: 'NODE_PC_03',
                    reasoning: "Casual tone, hedging language, frames as asking for favor. Triggers all her negative responses."
                  },
                  {
                    text: "Ms. Chen, I apologize for taking your time. We've encountered some challenges and unfortunately need to discuss budget adjustments.",
                    tone: "Formal/Apologetic",
                    rapportChange: -8,
                    nextNode: 'NODE_PC_04',
                    reasoning: "Leads with apology and focuses on problems rather than solutions. Shows weakness."
                  },
                  {
                    text: "Ms. Chen, I have a strategic proposal that could strengthen our competitive position and protect your investment. May I walk you through the analysis?",
                    tone: "Strategic/Collaborative",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_06',
                    reasoning: "Strategic framing, acknowledges her investment, asks permission respectfully while showing confidence."
                  }
                ]
              },
              'NODE_PC_02': {
                npcText: "Twenty-two percent? Show me your numbers. What's driving the cost increase?",
                status: 'warming',
                options: [
                  {
                    text: "Two factors: specialized equipment rental at $28K and expert consultation at $17K. Both address the scalability concerns your team raised in last month's review. Here's the cost-benefit breakdown.",
                    tone: "Confident/Detailed",
                    rapportChange: 20,
                    nextNode: 'NODE_PC_07',
                    reasoning: "Specific numbers, connects to her team's previous concerns, shows you've been paying attention."
                  },
                  {
                    text: "Well, there are several things... the vendors raised their prices, and we underestimated some requirements. It's complicated.",
                    tone: "Uncertain/Defensive",
                    rapportChange: -15,
                    nextNode: 'NODE_PC_08',
                    reasoning: "Vague, defensive, sounds like making excuses. Loses the momentum from strong opening."
                  },
                  {
                    text: "We're addressing two critical path bottlenecks. The $45K investment prevents a 3-week delay that would cost $78K in extended overhead and put your board presentation at risk.",
                    tone: "Strategic/Forward-looking",
                    rapportChange: 18,
                    nextNode: 'NODE_PC_09',
                    reasoning: "Frames as risk mitigation with specific cost comparison. Connects to her board position goal."
                  }
                ]
              },
              'NODE_PC_03': {
                npcText: "*leans back, arms crossed* I don't 'help people out' with budgets. This is business. If you can't articulate a clear value proposition in the next two minutes, we're done here.",
                status: 'cooling',
                options: [
                  {
                    text: "You're right. Let me be clear: $45K investment, 22% ROI increase, three-week acceleration. Here are the specifics.",
                    tone: "Recovery/Direct",
                    rapportChange: 8,
                    nextNode: 'NODE_PC_10',
                    reasoning: "Acknowledges mistake, pivots immediately to her preferred style. Shows you can adapt."
                  },
                  {
                    text: "I'm sorry, I didn't mean to waste your time. Maybe I should come back when I've prepared better?",
                    tone: "Apologetic/Nervous",
                    rapportChange: -20,
                    nextNode: 'NODE_PC_11',
                    reasoning: "Displays weakness, considers retreating. This is her absolute worst trigger."
                  },
                  {
                    text: "I'm not asking for charity. This is a legitimate business need that affects the entire project.",
                    tone: "Defensive/Emotional",
                    rapportChange: -15,
                    nextNode: 'NODE_PC_12',
                    reasoning: "Defensive and emotional. Doesn't provide the data she's demanding."
                  }
                ]
              },
              'NODE_PC_04': {
                npcText: "Skip the apologies. What specifically do you need and why should I approve it?",
                status: 'cooling',
                options: [
                  {
                    text: "Fair point. We need $45K for specialized equipment and expertise that will accelerate delivery and increase ROI by 22%. Here's the analysis.",
                    tone: "Confident/Pivoting",
                    rapportChange: 12,
                    nextNode: 'NODE_PC_13',
                    reasoning: "Takes direction well, shifts to confident and data-driven approach."
                  },
                  {
                    text: "I understand, I'm sorry. We're facing some unexpected complications that have made the original budget insufficient...",
                    tone: "Continued Apologetic",
                    rapportChange: -18,
                    nextNode: 'NODE_PC_14',
                    reasoning: "Continues apologizing, frames as problems not solutions. Shows you didn't hear her feedback."
                  },
                  {
                    text: "Understood. Requirement: $45K. Purpose: Two critical path items. Expected outcome: 3-week acceleration, 22% ROI improvement. I have the detailed breakdown ready.",
                    tone: "Professional/Structured",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_15',
                    reasoning: "Direct, structured, confident. Shows you can match her communication style."
                  }
                ]
              },
              'NODE_PC_06': {
                npcText: "Go ahead. I'm listening.",
                status: 'warming',
                options: [
                  {
                    text: "We've identified two high-impact investments totaling $45K. Combined, they accelerate delivery by three weeks and increase projected ROI from 18% to 22%. The competitive advantage timeline is critical given market movements.",
                    tone: "Strategic/Data-driven",
                    rapportChange: 18,
                    nextNode: 'NODE_PC_07',
                    reasoning: "Connects data to strategic context, mentions competitive advantage. Speaks to her board position ambitions."
                  },
                  {
                    text: "I'd like to walk through the full analysis together. There are some interesting implications for the market positioning you've been developing...",
                    tone: "Collaborative/Detailed",
                    rapportChange: 5,
                    nextNode: 'NODE_PC_19',
                    reasoning: "Collaborative but slightly tentative. ENTJs prefer efficiency over extended discussion."
                  }
                ]
              },
              'NODE_PC_07': {
                npcText: "Interesting. The three-week acceleration is significant. Walk me through the scalability concerns my team raised. How does this address them?",
                status: 'warming',
                options: [
                  {
                    text: "Your team identified potential bottlenecks in data processing at scale. The $28K equipment investment increases processing capacity by 400%, eliminating that risk entirely. The $17K expert consultation addresses the architecture concerns Dr. Martinez raised about concurrent user loads.",
                    tone: "Expert/Direct",
                    rapportChange: 20,
                    nextNode: 'NODE_PC_21',
                    reasoning: "Shows deep knowledge of her team's concerns, specific solutions, even name-drops the researcher."
                  },
                  {
                    text: "The investments directly target the bottleneck issuesâ€”processing capacity and architecture optimization. Both were flagged as high-priority risks.",
                    tone: "Confident/Summarized",
                    rapportChange: 12,
                    nextNode: 'NODE_PC_22',
                    reasoning: "Accurate but less detailed. Still good, just not as impressive."
                  },
                  {
                    text: "Well, the equipment should help with the processing issues, and the consultant has experience with these types of concerns...",
                    tone: "Uncertain/Vague",
                    rapportChange: -10,
                    nextNode: 'NODE_PC_23',
                    reasoning: "Hedging language ('should'), lack of specificity. Undermines previous strong showing."
                  }
                ]
              },
              'NODE_PC_08': {
                npcText: "Complicated? I don't pay for complications, I pay for solutions. You had one job: deliver on budget. Why should I trust you with more money?",
                status: 'cooling',
                options: [
                  {
                    text: "Fair challenge. Here's what happened and what we're doing about it: market conditions shifted, we identified the gap early, and this investment prevents larger problems. I take full accountability and here's the mitigation plan.",
                    tone: "Recovery/Accountable",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_24',
                    reasoning: "Takes accountability, provides facts, shows proactive problem-solving. Decent recovery."
                  },
                  {
                    text: "This wasn't our faultâ€”the vendors changed terms, and the requirements evolved beyond the initial scope...",
                    tone: "Defensive/Excuse-making",
                    rapportChange: -25,
                    nextNode: 'NODE_PC_25',
                    reasoning: "CRITICAL FAILURE. Blame-shifting and excuses are her worst trigger."
                  },
                  {
                    text: "You shouldn't trust wordsâ€”you should trust data. Here's the cost-benefit analysis showing exactly how this investment protects your timeline and increases returns.",
                    tone: "Strategic Pivot",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_26',
                    reasoning: "Confident redirection to data. Acknowledges her challenge and meets it directly."
                  }
                ]
              },
              'NODE_PC_09': {
                npcText: "Now you're speaking my language. My board presentation is in six weeks. How does this timeline work with that?",
                status: 'warming',
                options: [
                  {
                    text: "Perfect alignment. With approval this week, we'll have preliminary results in four weeksâ€”giving you two weeks to incorporate them into your presentation with actual performance data, not projections.",
                    tone: "Strategic/Precise",
                    rapportChange: 20,
                    nextNode: 'NODE_PC_27',
                    reasoning: "Specific timeline, shows you understand her political needs, provides strategic advantage for her board goals."
                  },
                  {
                    text: "The timeline supports your presentation perfectly. We'll have deliverables ready with time to spare.",
                    tone: "Confident/Supportive",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_28',
                    reasoning: "Good but less specific. Doesn't provide the strategic insight she's looking for."
                  },
                  {
                    text: "Oh that's great timing! We should definitely be able to get you something good for that presentation.",
                    tone: "Enthusiastic/Casual",
                    rapportChange: -8,
                    nextNode: 'NODE_PC_29',
                    reasoning: "Too casual, vague language ('should', 'something good'). Doesn't match the strategic moment."
                  }
                ]
              },
              'NODE_PC_10': {
                npcText: "Better. Now tell me why this specific investment is smarter than the five other ways you could solve this problem.",
                status: 'pending',
                options: [
                  {
                    text: "We evaluated seven alternatives. This option has the best cost-to-impact ratio, shortest implementation time, and creates reusable capacity for future phases. Options 2 and 3 were close but added 2-3 weeks. I have the comparison matrix if you want details.",
                    tone: "Analytical/Confident",
                    rapportChange: 18,
                    nextNode: 'NODE_PC_30',
                    reasoning: "Shows thorough analysis, provides clear rationale, offers details without forcing them."
                  },
                  {
                    text: "This approach addresses the core issues most directly and efficiently while staying within reasonable budget parameters.",
                    tone: "General/Adequate",
                    rapportChange: 5,
                    nextNode: 'NODE_PC_31',
                    reasoning: "Accurate but generic. Doesn't show the analytical depth she's testing for."
                  },
                  {
                    text: "We looked at other options, but this one seemed like the best fit for what we need.",
                    tone: "Uncertain/Incomplete",
                    rapportChange: -15,
                    nextNode: 'NODE_PC_32',
                    reasoning: "Vague, weak language ('seemed like'). Suggests insufficient analysis."
                  }
                ]
              },
              'NODE_PC_11': {
                npcText: "*stands up* We're done. If you're not prepared to make a professional presentation, you're not prepared to manage this project. I'm pulling my support.",
                status: 'refused',
                options: [
                  {
                    text: "Wait, please! I have the data right here. Let me show youâ€”",
                    tone: "Desperate Recovery",
                    rapportChange: -20,
                    nextNode: 'NODE_PC_FAIL',
                    reasoning: "TERMINAL. Once she's made this decision, desperation only confirms her judgment."
                  },
                  {
                    text: "I understand. Thank you for your time.",
                    tone: "Accepting/Professional",
                    rapportChange: 0,
                    nextNode: 'NODE_PC_FAIL',
                    reasoning: "TERMINAL. Professional exit but relationship is over."
                  }
                ]
              },
              'NODE_PC_12': {
                npcText: "Legitimate need? Everyone has legitimate needs. I don't have time for feelingsâ€”show me the business case or we're done.",
                status: 'cooling',
                options: [
                  {
                    text: "You're absolutely right. Here's the business case: $45K investment, 22% ROI increase, three-week acceleration, with specific breakdown on equipment and expertise costs.",
                    tone: "Final Recovery",
                    rapportChange: 12,
                    nextNode: 'NODE_PC_33',
                    reasoning: "Last chance recovery. Immediate shift to data. Challenging but possible to salvage."
                  },
                  {
                    text: "I AM showing you the business case. This project affects everyone's success, including yours.",
                    tone: "Frustrated/Emotional",
                    rapportChange: -25,
                    nextNode: 'NODE_PC_34',
                    reasoning: "CRITICAL FAILURE. Emotional response and implied threat. Terminal."
                  }
                ]
              },
              'NODE_PC_13': {
                npcText: "Much better. Specificity matters. What's the risk if I don't approve this?",
                status: 'warming',
                options: [
                  {
                    text: "Three-week delay minimum, $78K in extended overhead costs, and you miss your board presentation window. The competitive advantage window closes in Q2.",
                    tone: "Direct/Risk-focused",
                    rapportChange: 20,
                    nextNode: 'NODE_PC_35',
                    reasoning: "Specific risks, quantified costs, connects to her strategic goals."
                  },
                  {
                    text: "We'd face delays and cost overruns that would impact the overall project timeline and ROI.",
                    tone: "Balanced/Professional",
                    rapportChange: 5,
                    nextNode: 'NODE_PC_36',
                    reasoning: "Accurate but generic. Doesn't provide the sharp analysis she expects."
                  }
                ]
              },
              'NODE_PC_14': {
                npcText: "*stands up* I don't work with people who can't own their decisions. This conversation is over.",
                status: 'cooling',
                options: [
                  {
                    text: "Please, just give me one more minuteâ€”",
                    tone: "Desperate",
                    rapportChange: -15,
                    nextNode: 'NODE_PC_FAIL',
                    reasoning: "TERMINAL. She's made her decision."
                  },
                  {
                    text: "I understand. Thank you for your time.",
                    tone: "Professional Exit",
                    rapportChange: 0,
                    nextNode: 'NODE_PC_FAIL',
                    reasoning: "TERMINAL. Clean exit but no recovery possible."
                  }
                ]
              },
              'NODE_PC_15': {
                npcText: "That's more like it. Show me the breakdown.",
                status: 'warming',
                options: [
                  {
                    text: "$28K for specialized processing equipmentâ€”400% capacity increase, addresses scalability bottleneck. $17K for architecture consultantâ€”optimizes concurrent user loads. Combined impact: 22% ROI increase, three-week acceleration.",
                    tone: "Detailed/Confident",
                    rapportChange: 20,
                    nextNode: 'NODE_PC_07',
                    reasoning: "Specific, confident, ties investments to concrete outcomes."
                  },
                  {
                    text: "Equipment costs $28K, consultation $17K. Both address critical path items identified in our risk assessment.",
                    tone: "Summary/Professional",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_38',
                    reasoning: "Adequate but less impressive. Shows competence without depth."
                  }
                ]
              },
              'NODE_PC_19': {
                npcText: "I don't need us to 'walk through' anything. Give me the executive summaryâ€”I'll ask questions if I need details.",
                status: 'warming',
                options: [
                  {
                    text: "Understood. $45K investment, two components: equipment and expertise. Result: 22% ROI increase, three-week acceleration, addresses your team's scalability concerns.",
                    tone: "Efficient/Direct",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_07',
                    reasoning: "Adapts immediately to her preference for efficiency."
                  }
                ]
              },
              'NODE_PC_21': {
                npcText: "*leans forward* Now that's what I call due diligence. You've clearly done your homework. I have one more question: what's your contingency if the consultant underdelivers?",
                status: 'agreed',
                options: [
                  {
                    text: "We have a performance milestone structure built into the contractâ€”payments tied to deliverables at weeks 1, 2, and 4. If they underdeliver, we've identified two backup consultants with identical expertise who can step in with 48-hour notice.",
                    tone: "Confident/Prepared",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "Shows thorough planning, risk mitigation, backup plans. WIN CONDITION MET."
                  },
                  {
                    text: "We've structured the contract with milestone-based payments and have backup options identified if needed.",
                    tone: "Confident/Less Detailed",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_46',
                    reasoning: "Good answer but less impressive. Still likely leads to success."
                  }
                ]
              },
              'NODE_PC_22': {
                npcText: "Good. What about implementation timeline? When do you need the approval, and when do I see results?",
                status: 'warming',
                options: [
                  {
                    text: "Approval this week starts immediate procurement. Equipment operational in 10 days, consultant begins week 2. First measurable results in 3 weeksâ€”preliminary data for your board presentation in 5 weeks, giving you a 1-week buffer.",
                    tone: "Precise/Strategic",
                    rapportChange: 12,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "Specific timeline, connects to her board needs. WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_23': {
                npcText: "Should? I don't approve budgets based on 'should.' Either you know what this will deliver or you don't.",
                status: 'cooling',
                options: [
                  {
                    text: "You're right. The equipment WILL increase processing capacity by 400%, eliminating the bottleneck. The consultant WILL optimize the architecture for concurrent loads. I have the specifications and performance guarantees in writing.",
                    tone: "Recovery/Definitive",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_49',
                    reasoning: "Strong recovery, removes hedging, provides concrete assurances."
                  },
                  {
                    text: "I'm confident in the solutionsâ€”I just meant that implementation always has some variables...",
                    tone: "Defensive",
                    rapportChange: -15,
                    nextNode: 'NODE_PC_50',
                    reasoning: "More hedging and defensiveness. Confirms her concerns."
                  }
                ]
              },
              'NODE_PC_24': {
                npcText: "I respect accountability. But taking ownership of mistakes doesn't automatically earn you more money. Convince me this investment is smart, not just necessary.",
                status: 'warming',
                options: [
                  {
                    text: "Smart because it's not just solving today's problemâ€”it creates reusable capacity for future phases. The $45K investment delivers benefits across three project phases, making the true ROI closer to 35% when fully utilized.",
                    tone: "Strategic/Investment-focused",
                    rapportChange: 18,
                    nextNode: 'NODE_PC_51',
                    reasoning: "Reframes from problem to opportunity, shows strategic thinking about future value."
                  },
                  {
                    text: "Smart because the alternativeâ€”delays and workaroundsâ€”costs $78K in extended overhead, making this investment save $33K while delivering better outcomes.",
                    tone: "Practical/Direct",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_52',
                    reasoning: "Strong cost-benefit argument with specific numbers."
                  }
                ]
              },
              'NODE_PC_25': {
                npcText: "I've heard enough. You're not equipped to manage this project. I'm recommending replacement leadership. We're done.",
                status: 'refused',
                options: [
                  {
                    text: "[No options available - conversation ended]",
                    tone: "Terminal",
                    rapportChange: 0,
                    nextNode: 'NODE_PC_FAIL',
                    reasoning: "TERMINAL. Cannot recover."
                  }
                ]
              },
              'NODE_PC_26': {
                npcText: "Now you're talking. Show me.",
                status: 'warming',
                options: [
                  {
                    text: "$45K investment: $28K equipment yields 400% processing capacity increase, $17K consulting optimizes architecture. Combined result: 22% ROI improvement, three-week acceleration, $33K net savings vs. delay costs.",
                    tone: "Analytical/Confident",
                    rapportChange: 18,
                    nextNode: 'NODE_PC_39',
                    reasoning: "Comprehensive data, clear ROI story, confidence restored."
                  }
                ]
              },
              'NODE_PC_27': {
                npcText: "That's exactly what I need. Real data, not promises. Here's what I'll do: I'll approve the budget TODAY if you commit to weekly progress reports that I can use for my board narrative. Deal?",
                status: 'agreed',
                options: [
                  {
                    text: "Deal. Weekly progress reports every Friday by 5 PM, formatted for board presentation. You'll have the data you need.",
                    tone: "Confident/Committal",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "Clear commitment, specific delivery time. WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_28': {
                npcText: "Time to spare? Prove it. Give me specific dates.",
                status: 'warming',
                options: [
                  {
                    text: "Approval this week, equipment operational by November 30, consultant deliverables by December 15, preliminary results by December 22â€”four weeks before your January 20 board presentation.",
                    tone: "Precise/Prepared",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_55',
                    reasoning: "Specific dates show preparation."
                  }
                ]
              },
              'NODE_PC_29': {
                npcText: "*expression cools* I need certainty, not 'should definitely.' Give me exact timelines or this conversation is over.",
                status: 'cooling',
                options: [
                  {
                    text: "You're right. Here are exact dates: Approval this week, equipment operational November 30, preliminary results December 22, giving you four weeks of buffer before your January 20 presentation.",
                    tone: "Recovery/Precise",
                    rapportChange: 12,
                    nextNode: 'NODE_PC_57',
                    reasoning: "Immediate correction with specific information."
                  }
                ]
              },
              'NODE_PC_30': {
                npcText: "Impressive. Most people don't even look at alternatives. Send me the comparison matrix and the detailed proposal. If they check out, you have your approval.",
                status: 'agreed',
                options: [
                  {
                    text: "I'll have both in your inbox within two hours. The matrix includes all seven alternatives with cost, timeline, and impact analysis.",
                    tone: "Confident/Professional",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "Specific timeframe, describes what she'll receive. WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_31': {
                npcText: "That's not enough analysis for this size investment. I need more depth before I can approve.",
                status: 'pending',
                options: [
                  {
                    text: "Understood. Let me provide the detailed analysis: [continues with more specifics]",
                    tone: "Responding",
                    rapportChange: 5,
                    nextNode: 'NODE_PC_07',
                    reasoning: "Providing requested depth."
                  }
                ]
              },
              'NODE_PC_33': {
                npcText: "Finally. That's what I needed to hear. Show me the breakdown and if it holds up, you have approval.",
                status: 'warming',
                options: [
                  {
                    text: "[Present detailed breakdown with all specifics]",
                    tone: "Detailed",
                    rapportChange: 15,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "Meeting her requirements. WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_35': {
                npcText: "Now that's a compelling risk analysis. Approved. Don't make me regret this.",
                status: 'agreed',
                options: [
                  {
                    text: "You won't. I'll keep you updated with weekly progress reports.",
                    tone: "Confident",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_38': {
                npcText: "Adequate. I'll approve this, but I expect detailed reporting.",
                status: 'agreed',
                options: [
                  {
                    text: "Absolutely. Weekly updates with metrics.",
                    tone: "Professional",
                    rapportChange: 8,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_39': {
                npcText: "This is the level of analysis I expect. Approved. I want weekly updates.",
                status: 'agreed',
                options: [
                  {
                    text: "You'll have them every Friday. Thank you for your support.",
                    tone: "Professional",
                    rapportChange: 12,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_46': {
                npcText: "Good enough. I'll approve it. Keep me in the loop.",
                status: 'agreed',
                options: [
                  {
                    text: "Absolutely. Thank you, Ms. Chen.",
                    tone: "Professional",
                    rapportChange: 8,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_49': {
                npcText: "Much better. That's the confidence I needed to see. Approved.",
                status: 'agreed',
                options: [
                  {
                    text: "Thank you. I'll deliver on these commitments.",
                    tone: "Confident",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_51': {
                npcText: "Now that's strategic thinking. Approved. This is the kind of planning I like to see.",
                status: 'agreed',
                options: [
                  {
                    text: "Thank you. I'll ensure we maximize that long-term value.",
                    tone: "Strategic",
                    rapportChange: 12,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_52': {
                npcText: "Clear cost-benefit. That's what I needed. Approved.",
                status: 'agreed',
                options: [
                  {
                    text: "Thank you, Ms. Chen. I appreciate your support.",
                    tone: "Professional",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_55': {
                npcText: "Specific dates. Finally. Approved. Don't miss those milestones.",
                status: 'agreed',
                options: [
                  {
                    text: "We won't. Thank you for your support.",
                    tone: "Confident",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_57': {
                npcText: "That's what I needed. Approved. Deliver on those dates.",
                status: 'agreed',
                options: [
                  {
                    text: "Absolutely. Thank you, Ms. Chen.",
                    tone: "Professional",
                    rapportChange: 10,
                    nextNode: 'NODE_PC_SUCCESS',
                    reasoning: "WIN CONDITION MET."
                  }
                ]
              },
              'NODE_PC_SUCCESS': {
                npcText: "Approved. I'll have the paperwork processed by end of day. Don't make me regret this.",
                status: 'agreed',
                options: []
              },
              'NODE_PC_FAIL': {
                npcText: "*already walking away*",
                status: 'refused',
                options: []
              }
            },
            // INTERN TREE - James Park
            intern: {
              'NODE_JP_01': {
                npcText: "Oh, hi! Um, did you need something? *looks slightly nervous*",
                status: 'pending',
                options: [
                  {
                    text: "Hey James! I wanted to check in with you about the data analysis report. How are you feeling about it? Do you have everything you need?",
                    tone: "Warm/Mentorship",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_02',
                    reasoning: "Warm tone, checking in rather than demanding, asks about his needs. Perfect for ISFJ."
                  },
                  {
                    text: "James, I need that data analysis report completed by Friday. No excuses. Can you handle it or not?",
                    tone: "Direct/Demanding",
                    rapportChange: -20,
                    nextNode: 'NODE_JP_03',
                    reasoning: "Harsh, demanding, pressure-focused. Will likely paralyze him."
                  },
                  {
                    text: "James, I'm following up on the data analysis report due Friday. What's your current progress?",
                    tone: "Professional/Neutral",
                    rapportChange: 3,
                    nextNode: 'NODE_JP_04',
                    reasoning: "Professional but lacks warmth. Functional but doesn't make him feel supported."
                  },
                  {
                    text: "Hey James! I wanted to talk through the data analysis report together. I think your fresh perspective could really strengthen it. Do you have a few minutes?",
                    tone: "Collaborative/Encouraging",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_05',
                    reasoning: "Collaborative language, values his contribution, asks rather than demands. Excellent for ISFJs."
                  }
                ]
              },
              'NODE_JP_02': {
                npcText: "*relaxes slightly* Thanks for asking. I've started on it, but... honestly, I'm a bit overwhelmed. There's so much data and I want to make sure I'm analyzing it correctly. What if I miss something important?",
                status: 'warming',
                options: [
                  {
                    text: "That's totally normalâ€”this is a lot of data! Let's break it down together. What if we start with the three main metrics? I can show you the approach I usually take, and we'll work through it step by step.",
                    tone: "Reassuring/Mentorship",
                    rapportChange: 20,
                    nextNode: 'NODE_JP_07',
                    reasoning: "Normalizes his feelings, offers specific help, collaborative approach. Perfect for building confidence."
                  },
                  {
                    text: "I appreciate your thoroughness! Here's what matters most: customer retention rates, conversion metrics, and cost analysis. Focus on those three areas first. Let me know if you have questions.",
                    tone: "Encouraging/Clear",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_08',
                    reasoning: "Positive reinforcement, clear priorities, offers support. Good but less collaborative."
                  },
                  {
                    text: "You're overthinking it. Just run the standard analysis and you'll be fine.",
                    tone: "Minimizing",
                    rapportChange: -10,
                    nextNode: 'NODE_JP_09',
                    reasoning: "Dismisses his concerns, provides no actual guidance."
                  },
                  {
                    text: "James, you need to figure this out. The whole team is counting on you. Just get it done.",
                    tone: "Pressure/Impatient",
                    rapportChange: -25,
                    nextNode: 'NODE_JP_10',
                    reasoning: "CRITICAL NEGATIVE. Adds pressure without support. Will likely paralyze him."
                  }
                ]
              },
              'NODE_JP_03': {
                npcText: "*face goes pale, stammers* Iâ€”I can handle it. I'm working on it. I just... I mean, yes. I'll get it done. *looks down, avoiding eye contact*",
                status: 'cooling',
                options: [
                  {
                    text: "Hey, I'm sorryâ€”that came out wrong. I didn't mean to put pressure on you. I know you're working hard. How about we sit down and I can help you with any tricky parts?",
                    tone: "Recovery/Warm",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_12',
                    reasoning: "Acknowledges mistake, apologizes genuinely, offers support. Good recovery for ISFJs."
                  },
                  {
                    text: "Good. I need to see a draft by Wednesday so we have time for revisions. No mistakes.",
                    tone: "Doubling Down",
                    rapportChange: -25,
                    nextNode: 'NODE_JP_13',
                    reasoning: "CRITICAL FAILURE. Adds more pressure. Will completely shut him down."
                  },
                  {
                    text: "Okay. If you run into issues, let me know.",
                    tone: "Softening Slightly",
                    rapportChange: 5,
                    nextNode: 'NODE_JP_14',
                    reasoning: "Slight softening but damage already done. Minimal recovery."
                  }
                ]
              },
              'NODE_JP_04': {
                npcText: "I've started the data collection and preliminary organization. I'm about 30% through the full analysis. I should be able to finish by Friday.",
                status: 'pending',
                options: [
                  {
                    text: "That's great progress, James! The organization phase is crucial and you're right on track. If anything comes up or you want a second set of eyes on any section, I'm here to help.",
                    tone: "Encouraging/Warm",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_16',
                    reasoning: "Recognizes his progress, validates his work, offers support. Builds confidence."
                  },
                  {
                    text: "Good. Let me know if you encounter any roadblocks.",
                    tone: "Professional/Checking",
                    rapportChange: 5,
                    nextNode: 'NODE_JP_17',
                    reasoning: "Adequate but lacks warmth. Maintains neutral relationship."
                  },
                  {
                    text: "You 'should' be able to finish? That doesn't sound confident. Is there a problem?",
                    tone: "Concerned/Doubtful",
                    rapportChange: -12,
                    nextNode: 'NODE_JP_18',
                    reasoning: "Fixates on uncertainty, sounds critical. Makes him second-guess himself."
                  },
                  {
                    text: "Nice! The organization phase is where the insights really start to emerge. What patterns are you seeing so far? I'm curious about your take on it.",
                    tone: "Collaborative/Invested",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_19',
                    reasoning: "Shows genuine interest, asks for his perspective. Excellent for ISFJs."
                  }
                ]
              },
              'NODE_JP_05': {
                npcText: "*brightens up* Really? That would be amazing! I have some ideas but I wasn't sure if they were good enough to share. When would be a good time?",
                status: 'warming',
                options: [
                  {
                    text: "They're definitely good enoughâ€”I want to hear them! How about we grab coffee in 20 minutes and you can walk me through your approach? Your fresh eyes on this data might catch things the rest of us missed.",
                    tone: "Enthusiastic/Mentorship",
                    rapportChange: 20,
                    nextNode: 'NODE_JP_20',
                    reasoning: "Validates his ideas immediately, casual setting, emphasizes value of his perspective."
                  },
                  {
                    text: "I'd love to hear them! Let's schedule an hour tomorrow morning. Come prepared to share what you're thinking and we'll build on it together.",
                    tone: "Warm/Scheduling",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_21',
                    reasoning: "Shows genuine interest, gives him time to prepare, collaborative language."
                  },
                  {
                    text: "Your ideas are valuable, Jamesâ€”don't doubt that! How about you walk me through them right now if you have time? I'm all ears.",
                    tone: "Encouraging/Open",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_23',
                    reasoning: "Strong validation, immediate availability shows he's a priority."
                  }
                ]
              },
              'NODE_JP_07': {
                npcText: "*visibly relaxes* That would help so much! I was trying to look at everything at once and got stuck. Breaking it into pieces makes it feel less scary. Should I bring my laptop?",
                status: 'warming',
                options: [
                  {
                    text: "Absolutely! Bring your laptop and let's work through this together. I remember feeling exactly the same way on my first big analysis project. You're doing great by asking for helpâ€”that's a sign of a good analyst.",
                    tone: "Mentorship/Encouraging",
                    rapportChange: 20,
                    nextNode: 'NODE_JP_28',
                    reasoning: "Shares personal experience, validates help-seeking behavior. Builds confidence beautifully."
                  },
                  {
                    text: "Yes, bring your laptop and whatever notes you have. We'll create a clear roadmap so you know exactly what to tackle and in what order.",
                    tone: "Practical/Supportive",
                    rapportChange: 12,
                    nextNode: 'NODE_JP_29',
                    reasoning: "Clear and supportive, but less personal connection."
                  }
                ]
              },
              'NODE_JP_08': {
                npcText: "Okay, that helps! So if I focus on those three areas, what level of detail should I go into? Should I do charts and graphs, or mostly written analysis?",
                status: 'warming',
                options: [
                  {
                    text: "Great question! I'd recommend one clear visualization per metricâ€”a chart or graph that tells the story at a glanceâ€”plus 2-3 paragraphs of written insight for each. Quality over quantity. Does that feel manageable?",
                    tone: "Clear/Supportive",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_31',
                    reasoning: "Specific guidance, clear expectations, asks if it's manageable. Empowering."
                  },
                  {
                    text: "Let's think about your audienceâ€”the senior team wants quick visual insights. What format do you think would communicate the findings most effectively? I can share examples if that helps.",
                    tone: "Collaborative/Building",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_34',
                    reasoning: "Teaches critical thinking, offers examples. Mentorship approach."
                  }
                ]
              },
              'NODE_JP_09': {
                npcText: "*looks down* Oh... okay. I guess I'll just... figure it out then. *sounds defeated*",
                status: 'cooling',
                options: [
                  {
                    text: "Wait, Jamesâ€”I'm sorry, that wasn't helpful of me. You're not overthinking it, you're being thorough, which is good. Let me give you some actual guidance. What specific parts are you unsure about?",
                    tone: "Recovery/Caring",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_35',
                    reasoning: "Recognizes mistake, validates his concern, offers concrete help."
                  },
                  {
                    text: "You've got this! Just start with the basics and build from there.",
                    tone: "Encouraging/Redirect",
                    rapportChange: 5,
                    nextNode: 'NODE_JP_36',
                    reasoning: "Encouraging but still vague. Doesn't address his need for guidance."
                  }
                ]
              },
              'NODE_JP_10': {
                npcText: "*voice shaky* Okay. I understand. I'll... I'll figure it out. *looks overwhelmed and near tears* Sorry. I'll get it done.",
                status: 'cooling',
                options: [
                  {
                    text: "James, stop. I'm sorryâ€”that was completely unfair of me. You're not alone in this, and I shouldn't have said it that way. Take a breath. Let's sit down right now and I'll help you create a plan. This is manageable, I promise.",
                    tone: "Immediate Recovery/Compassionate",
                    rapportChange: 20,
                    nextNode: 'NODE_JP_38',
                    reasoning: "Strong, immediate recovery. Takes full accountability, offers immediate help."
                  },
                  {
                    text: "Hey, are you okay? I didn't mean to stress you out...",
                    tone: "Concerned/Awkward",
                    rapportChange: 5,
                    nextNode: 'NODE_JP_39',
                    reasoning: "Shows concern but awkward. Better than nothing but doesn't fully repair."
                  },
                  {
                    text: "Don't apologize, just do the work. I need you focused, not emotional.",
                    tone: "Frustrated/Impatient",
                    rapportChange: -30,
                    nextNode: 'NODE_JP_40',
                    reasoning: "TERMINAL. Dismisses his feelings. He will shut down completely."
                  }
                ]
              },
              'NODE_JP_12': {
                npcText: "*still looks nervous but hopeful* It's okay... I understand there's pressure. Um, actually, yes, I could use some help with the statistical analysis portion. I want to make sure I'm interpreting the data correctly.",
                status: 'pending',
                options: [
                  {
                    text: "Thank you for being understanding. And yes, absolutelyâ€”statistical analysis can be tricky. Let's block out an hour this afternoon. Bring your data and questions, and we'll work through it together. You're doing well, James. I mean that.",
                    tone: "Warm/Reassuring",
                    rapportChange: 20,
                    nextNode: 'NODE_JP_45',
                    reasoning: "Sincere appreciation, concrete plan, collaborative, genuine encouragement."
                  },
                  {
                    text: "Statistical analysis is one of the harder partsâ€”good instinct to ask for help. Let me show you the framework I use. Once you learn it, you'll be able to apply it to any dataset. Sound good?",
                    tone: "Mentorship/Patient",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_47',
                    reasoning: "Validates difficulty, teaches transferable skills. Effective mentorship."
                  }
                ]
              },
              'NODE_JP_13': {
                npcText: "*becomes visibly distressed, hands shaking* Wednesday? I... I don't think I can... I need toâ€” *voice breaks* I'm sorry, I need to go. *rushes out, clearly overwhelmed*",
                status: 'refused',
                options: [
                  {
                    text: "[Conversation ended - James has left]",
                    tone: "Terminal",
                    rapportChange: 0,
                    nextNode: 'NODE_JP_FAIL',
                    reasoning: "TERMINAL. He's completely shut down."
                  }
                ]
              },
              'NODE_JP_14': {
                npcText: "*nods quietly* Okay. Thank you. *doesn't make eye contact, still clearly anxious*",
                status: 'cooling',
                options: [
                  {
                    text: "James, I can see I rattled you and I'm genuinely sorry. I don't want you working on this feeling stressed. Can we start over? Let me actually help you properly.",
                    tone: "Genuine Care/Follow-up",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_48',
                    reasoning: "Acknowledges his emotional state, genuine apology, concrete offer."
                  },
                  {
                    text: "Great. Keep me posted. *leaves*",
                    tone: "Moving On",
                    rapportChange: -8,
                    nextNode: 'NODE_JP_49',
                    reasoning: "Ignores obvious anxiety. He'll struggle alone."
                  }
                ]
              },
              'NODE_JP_16': {
                npcText: "Thank you! That means a lot. Actually, I did have one questionâ€”when you say 'second set of eyes,' do you mean you'd want to review it before Friday, or just if I get stuck on something specific?",
                status: 'warming',
                options: [
                  {
                    text: "Great question! I'm flexibleâ€”whatever helps you most. If you'd feel more confident having me review a draft before the deadline, I'm happy to. Or if you just want to check in on specific questions as they come up, that works too. What sounds better to you?",
                    tone: "Clear/Supportive",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_54',
                    reasoning: "Empowers him to choose, both options are supportive."
                  },
                  {
                    text: "I'd love to review a draft on Thursdayâ€”not to critique, but so we can talk through your analysis together. That way you'll learn what strong analysis looks like and feel more confident next time.",
                    tone: "Mentorship/Teaching",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_57',
                    reasoning: "Frames review as learning opportunity, removes fear of criticism."
                  }
                ]
              },
              'NODE_JP_17': {
                npcText: "Okay, will do. *turns back to work, seems fine but not particularly engaged*",
                status: 'pending',
                options: [
                  {
                    text: "Wait, Jamesâ€”before you go, how are you finding everything so far? Is the team giving you what you need to succeed?",
                    tone: "Warming Up/Personal",
                    rapportChange: 10,
                    nextNode: 'NODE_JP_58',
                    reasoning: "Shows genuine interest, opens door for him to share concerns."
                  }
                ]
              },
              'NODE_JP_18': {
                npcText: "*looks worried* No, there's no problem! I mean... I was just trying to be realistic about timelines. I'll make sure it's done by Friday. Definitely. I'm sorry if that sounded uncertain.",
                status: 'cooling',
                options: [
                  {
                    text: "James, relaxâ€”I'm not criticizing you. Being realistic is actually good project management. I just want to make sure you have support if you need it. You're doing fine. Really.",
                    tone: "Recovery/Encouraging",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_61',
                    reasoning: "Immediately reassures, reframes his behavior as positive."
                  },
                  {
                    text: "Okay, but if there IS a concern, I need to know now, not on Thursday night.",
                    tone: "Pressing",
                    rapportChange: -10,
                    nextNode: 'NODE_JP_62',
                    reasoning: "Sounds like pressure/distrust. Makes him feel like he's in trouble."
                  }
                ]
              },
              'NODE_JP_19': {
                npcText: "*lights up* Oh! Well, I noticed that the retention rates drop significantly in month 3, but there's a patternâ€”it mostly affects users who didn't complete the onboarding tutorial. I wasn't sure if that was significant enough to highlight, but...",
                status: 'warming',
                options: [
                  {
                    text: "James, that's exactly the kind of insight we need! That's not just significantâ€”that's actionable. You just identified a potential intervention point. Make that a key finding in your report. This is great work.",
                    tone: "Enthusiastic/Validating",
                    rapportChange: 25,
                    nextNode: 'NODE_JP_64',
                    reasoning: "Strong validation, explains why it matters. Massive confidence boost."
                  },
                  {
                    text: "That's a really good catch. That's definitely worth including. What do you think might be causing that pattern?",
                    tone: "Encouraging/Thoughtful",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_65',
                    reasoning: "Validates finding, asks for more analysis. Good but less enthusiastic."
                  },
                  {
                    text: "Yes! You see? This is why I wanted your fresh perspective! The rest of us might have missed that because we're too close to it. Let's build on thisâ€”what else are you seeing?",
                    tone: "Excited/Collaborative",
                    rapportChange: 22,
                    nextNode: 'NODE_JP_67',
                    reasoning: "Makes him feel valuable, collaborative, encourages more sharing."
                  }
                ]
              },
              'NODE_JP_20': {
                npcText: "Really? Okay, yes! That would be amazing. I've been nervous about whether my approach is too basic, but I'll show you what I'm thinking. *looks relieved and excited*",
                status: 'warming',
                options: [
                  {
                    text: "I bet it's not too basic at allâ€”you're probably being too hard on yourself. Let's see what you've got, and we'll build from there. Grab your stuff and let's go! I want to hear all about your approach.",
                    tone: "Mentorship/Reassuring",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_68',
                    reasoning: "Preemptively reassures, encourages him, enthusiastic."
                  },
                  {
                    text: "Even if it is basic, that's totally fineâ€”we can always add layers. Starting simple and building complexity is actually smart analysis. See you in 20.",
                    tone: "Encouraging/Practical",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_69',
                    reasoning: "Normalizes 'basic,' reframes as positive strategy."
                  }
                ]
              },
              'NODE_JP_21': {
                npcText: "Perfect! That gives me tonight to organize my thoughts better. I really appreciate you making time for this. Should I prepare anything specific, or just bring what I have?",
                status: 'warming',
                options: [
                  {
                    text: "Just bring what you haveâ€”your current data, any analysis you've started, and your questions. Don't stress about making it perfect. The whole point is we'll work on it together.",
                    tone: "Clear/Supportive",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_71',
                    reasoning: "Clear expectations, removes pressure for perfection. Very reassuring."
                  }
                ]
              },
              'NODE_JP_23': {
                npcText: "Really? Yes, I have time! Okay, so I was thinking about segmenting the data by user type first, then tracking their journey through different metrics. Is that... is that a good approach?",
                status: 'warming',
                options: [
                  {
                    text: "That's a really smart approach! Segmentation gives you much more meaningful insights than looking at aggregated data. You're thinking like an analyst. Walk me through the segments you're considering.",
                    tone: "Affirming/Enthusiastic",
                    rapportChange: 20,
                    nextNode: 'NODE_JP_77',
                    reasoning: "Strong affirmation, validates his strategic thinking. Big confidence boost."
                  },
                  {
                    text: "I like where you're going with this! Let's map it out on the whiteboard together. We can visualize the segments and see how the analysis would flow. Come on!",
                    tone: "Collaborative/Building",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_80',
                    reasoning: "Enthusiastic, physical activity, collaborative. Engaging and supportive."
                  }
                ]
              },
              'NODE_JP_28': {
                npcText: "*smiles with genuine relief* Thank you so much. That really helpsâ€”knowing you felt the same way makes me feel less like I'm the only one struggling. And you're right, I should have asked sooner instead of trying to figure it all out alone.",
                status: 'agreed',
                options: [
                  {
                    text: "Hey, you asked at exactly the right time. Don't be hard on yourself. Asking for help shows maturity and good judgmentâ€”two qualities we really value. Now let's get this analysis organized so you feel confident about it. See you in a bit!",
                    tone: "Warm/Affirming",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Reframes help-seeking positively, affirms his qualities. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_29': {
                npcText: "That sounds perfect. I work much better when I have a clear plan. Thank you for being so patient with me.",
                status: 'warming',
                options: [
                  {
                    text: "You don't need to thank me for patienceâ€”this is what good teamwork looks like. You're asking the right questions and showing initiative. That's exactly what we want. See you tomorrow!",
                    tone: "Reassuring/Kind",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Normalizes support as teamwork, affirms his behavior. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_31': {
                npcText: "Yes, that feels totally manageable! Thank you for breaking it down. I feel much more confident now.",
                status: 'warming',
                options: [
                  {
                    text: "Perfect! You're going to do great. Remember, I'm here if you need anything.",
                    tone: "Encouraging",
                    rapportChange: 12,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Confidence building. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_34': {
                npcText: "I think visual would work best, with some written explanation. Examples would be really helpful!",
                status: 'warming',
                options: [
                  {
                    text: "Great thinking! I'll send you some examples by end of day. You're on the right track.",
                    tone: "Supportive",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Validates his thinking, provides resources. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_35': {
                npcText: "Thank you. I'm unsure about how to handle the outliers in the data and which statistical tests to use.",
                status: 'warming',
                options: [
                  {
                    text: "Those are excellent questions. Let's schedule 30 minutes to walk through both. I'll show you the decision framework we use.",
                    tone: "Teaching/Supportive",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Addresses his specific concerns. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_38': {
                npcText: "*takes a breath, nods* Okay. Thank you. That... that would really help.",
                status: 'warming',
                options: [
                  {
                    text: "Good. Let's sit down right now and create a clear plan together. You're going to be fine.",
                    tone: "Compassionate/Action",
                    rapportChange: 20,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Immediate action, reassurance. WIN CONDITION after recovery."
                  }
                ]
              },
              'NODE_JP_40': {
                npcText: "*shuts down completely, stares at desk*",
                status: 'refused',
                options: [
                  {
                    text: "[James is unable to respond]",
                    tone: "Terminal",
                    rapportChange: 0,
                    nextNode: 'NODE_JP_FAIL',
                    reasoning: "TERMINAL. Completely paralyzed."
                  }
                ]
              },
              'NODE_JP_45': {
                npcText: "Thank you. I really appreciate your help. I'll see you this afternoon.",
                status: 'warming',
                options: [
                  {
                    text: "See you then! We'll get through this together.",
                    tone: "Warm",
                    rapportChange: 12,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Collaborative close. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_47': {
                npcText: "That sounds great! I'd love to learn the framework. When works for you?",
                status: 'warming',
                options: [
                  {
                    text: "Let's do tomorrow morning. I'll walk you through it step by step.",
                    tone: "Teaching",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Clear teaching approach. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_48': {
                npcText: "*looks up* Really? Okay... yes, that would be good. Thank you.",
                status: 'warming',
                options: [
                  {
                    text: "Let's sit down right now and map out a plan together.",
                    tone: "Supportive Action",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Immediate support. WIN CONDITION after recovery."
                  }
                ]
              },
              'NODE_JP_49': {
                npcText: "*continues working quietly, clearly anxious*",
                status: 'cooling',
                options: [
                  {
                    text: "[James will likely struggle and may not deliver quality work]",
                    tone: "Outcome",
                    rapportChange: 0,
                    nextNode: 'NODE_JP_FAIL',
                    reasoning: "Failed to provide support. Likely poor outcome."
                  }
                ]
              },
              'NODE_JP_54': {
                npcText: "I think having you review a draft would help me learn. Thursday would be perfect.",
                status: 'warming',
                options: [
                  {
                    text: "Great! Send it over Thursday morning and we'll go through it together.",
                    tone: "Collaborative",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Sets up collaborative review. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_57': {
                npcText: "That would be really helpful! Thank you for framing it that way.",
                status: 'warming',
                options: [
                  {
                    text: "Of course! Send it over Thursday and we'll make it a learning session.",
                    tone: "Teaching/Warm",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Positive learning framing. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_58': {
                npcText: "Oh! Yeah, actually everyone's been really helpful. I'm learning a lot.",
                status: 'warming',
                options: [
                  {
                    text: "That's great to hear! Keep up the good work, James.",
                    tone: "Encouraging",
                    rapportChange: 10,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Positive affirmation. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_61': {
                npcText: "*visibly relaxes* Thank you. I appreciate that. I'll let you know if I need help.",
                status: 'warming',
                options: [
                  {
                    text: "Perfect. My door's always open.",
                    tone: "Supportive",
                    rapportChange: 12,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Reassurance provided. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_64': {
                npcText: "*beaming* Really? Okay! I'll make sure to highlight that in the report. Thank you!",
                status: 'agreed',
                options: [
                  {
                    text: "You should be proud of that insight. Looking forward to reading your analysis.",
                    tone: "Validating",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Strong validation. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_65': {
                npcText: "I think it might be because the tutorial is optional. Maybe we should make it required?",
                status: 'warming',
                options: [
                  {
                    text: "That's a solid hypothesis. Include that recommendation in your report.",
                    tone: "Encouraging Analysis",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Validates his analytical thinking. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_67': {
                npcText: "*excitedly* Well, I also noticed... *continues sharing insights*",
                status: 'agreed',
                options: [
                  {
                    text: "This is excellent work, James. Keep going!",
                    tone: "Enthusiastic",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "High engagement and validation. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_68': {
                npcText: "*smiles* Okay! Let me grab my laptop. Thank you!",
                status: 'agreed',
                options: [
                  {
                    text: "See you in the cafe in 20!",
                    tone: "Warm",
                    rapportChange: 15,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Informal mentorship established. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_69': {
                npcText: "That makes me feel better. See you soon!",
                status: 'warming',
                options: [
                  {
                    text: "See you in 20!",
                    tone: "Friendly",
                    rapportChange: 12,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Positive interaction. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_71': {
                npcText: "Perfect. I'll bring everything. Thank you again!",
                status: 'warming',
                options: [
                  {
                    text: "Looking forward to it!",
                    tone: "Supportive",
                    rapportChange: 12,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Clear plan established. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_77': {
                npcText: "*excited* Okay! So I was thinking we could segment by: new users, returning users, and power users...",
                status: 'agreed',
                options: [
                  {
                    text: "Perfect! Let's map that out together.",
                    tone: "Collaborative",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Collaborative working relationship. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_80': {
                npcText: "*enthusiastically* Yes! Let's do it!",
                status: 'agreed',
                options: [
                  {
                    text: "*heads to whiteboard together*",
                    tone: "Collaborative",
                    rapportChange: 18,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Active collaboration established. WIN CONDITION."
                  }
                ]
              },
              'NODE_JP_62': {
                npcText: "*looks anxious again* No, no concern. I'll make sure to communicate early if anything comes up.",
                status: 'cooling',
                options: [
                  {
                    text: "Okay. Just checking. You're doing fine.",
                    tone: "Softening",
                    rapportChange: 5,
                    nextNode: 'NODE_JP_SUCCESS',
                    reasoning: "Minimal recovery. Adequate outcome."
                  }
                ]
              },
              'NODE_JP_SUCCESS': {
                npcText: "*works with confidence and delivers quality report*",
                status: 'agreed',
                options: []
              },
              'NODE_JP_FAIL': {
                npcText: "*too paralyzed to deliver quality work*",
                status: 'refused',
                options: []
              }
            },
            // COLLEAGUE TREE - Dr. Sarah Martinez - abbreviated for length
            colleague: {
              'NODE_SM_01': {
                npcText: "I got your meeting request. What's this about the presentation?",
                status: 'pending',
                options: [
                  {
                    text: "Dr. Martinez, thank you for making time. I wanted to discuss how we can incorporate your team's research into the Project Phoenix presentation. Your findings would really strengthen our narrative, and I want to make sure we represent your work appropriately.",
                    tone: "Collaborative/Respectful",
                    rapportChange: 18,
                    nextNode: 'NODE_SM_02',
                    reasoning: "Collaborative framing, acknowledges expertise, emphasizes appropriate representation."
                  },
                  {
                    text: "We need your team's research data for the presentation next week. Can you send that over by Wednesday?",
                    tone: "Direct/Demanding",
                    rapportChange: -15,
                    nextNode: 'NODE_SM_03',
                    reasoning: "Demanding tone, treats her as subordinate, no discussion of credit."
                  },
                  {
                    text: "Dr. Martinez, I'm hoping we can explore a collaboration. Your team's research aligns perfectly with Project Phoenix's goals, and I believe a partnership would benefit both our initiatives. Could we discuss how this might work?",
                    tone: "Diplomatic/Strategic",
                    rapportChange: 20,
                    nextNode: 'NODE_SM_05',
                    reasoning: "Partnership language, mutual benefit framing, respects her autonomy."
                  }
                ]
              },
              'NODE_SM_02': {
                npcText: "I appreciate that you're thinking about representation. What specifically are you hoping to include, and how do you plan to credit the work?",
                status: 'warming',
                options: [
                  {
                    text: "We'd like to feature your findings on scalability architectureâ€”specifically the concurrent load optimization work. Full attribution would include your team's names on the slide, proper citations, and if you're comfortable with it, perhaps you could present that section yourself at the stakeholder meeting?",
                    tone: "Thoughtful/Specific",
                    rapportChange: 22,
                    nextNode: 'NODE_SM_07',
                    reasoning: "Specific about what's needed, multiple attribution methods, invites her to present."
                  },
                  {
                    text: "That's exactly what I wanted to discuss with you. I'd like your input on what findings would be most relevant and how you'd prefer to be credited. This should be a collaborative decision.",
                    tone: "Collaborative/Open",
                    rapportChange: 18,
                    nextNode: 'NODE_SM_08',
                    reasoning: "Gives her control over the process."
                  }
                ]
              },
              'NODE_SM_03': {
                npcText: "*expression hardens* I don't 'send over' three years of research on demand. My team's work isn't a resource for you to extract. If you want to discuss a proper collaboration, we can talk. Otherwise, I'm busy.",
                status: 'cooling',
                options: [
                  {
                    text: "You're absolutely right, and I apologize. That came out wrong. I'd like to discuss a proper collaboration where your team is appropriately credited and involved. May we start over?",
                    tone: "Recovery/Respectful",
                    rapportChange: 18,
                    nextNode: 'NODE_SM_11',
                    reasoning: "Immediate acknowledgment of error, genuine apology."
                  },
                  {
                    text: "This is for an official project presentation. All departments are expected to contribute relevant research.",
                    tone: "Defensive/Bureaucratic",
                    rapportChange: -25,
                    nextNode: 'NODE_SM_12',
                    reasoning: "CRITICAL NEGATIVE. Doubles down on demanding."
                  }
                ]
              },
              'NODE_SM_05': {
                npcText: "*interest visible* I'm listening. What kind of partnership are you envisioning, and how does it benefit my team's research agenda?",
                status: 'warming',
                options: [
                  {
                    text: "Your research gains visibility with stakeholders who control fundingâ€”including the board members attending this presentation. For us, your findings provide the scientific foundation for our scalability claims. It's mutually beneficial if structured correctly. I'm thinking co-presentation, full attribution, and ensuring your team's methodology isn't oversimplified.",
                    tone: "Strategic/Thoughtful",
                    rapportChange: 25,
                    nextNode: 'NODE_SM_19',
                    reasoning: "Specific benefits for her, addresses concerns about oversimplification."
                  },
                  {
                    text: "I'll be honestâ€”I'm still figuring out the best structure. But I know your research is crucial to our success, and I want to make sure any partnership serves your team's interests too. What would meaningful collaboration look like from your perspective?",
                    tone: "Honest/Uncertain",
                    rapportChange: 18,
                    nextNode: 'NODE_SM_21',
                    reasoning: "Refreshingly honest, asks for her input. INTJs appreciate authenticity."
                  }
                ]
              },
              'NODE_SM_07': {
                npcText: "*noticeably more engaged* Now that's a thoughtful approach. I appreciate the specificity. Having my team present our own work would address my main concern about misrepresentation. What's the time allocation for that section?",
                status: 'warming',
                options: [
                  {
                    text: "I'm thinking 10-15 minutes for the technical presentation, plus Q&A. But I'm flexibleâ€”what do you think would be appropriate to properly cover the methodology and findings without oversimplifying?",
                    tone: "Collaborative/Flexible",
                    rapportChange: 20,
                    nextNode: 'NODE_SM_27',
                    reasoning: "Gives specific timeframe, asks for her expertise."
                  }
                ]
              },
              'NODE_SM_08': {
                npcText: "I appreciate being consulted. Let me think about this... The concurrent load optimization findings would be most relevant. But I'd want to ensure we don't oversimplify the methodologyâ€”that's where most presentations go wrong with technical research.",
                status: 'warming',
                options: [
                  {
                    text: "That's a valid concern. What if you present that section yourself? You could pitch it at the level you deem appropriate, and I trust your judgment on balancing rigor with accessibility for a mixed audience.",
                    tone: "Understanding/Problem-solving",
                    rapportChange: 20,
                    nextNode: 'NODE_SM_31',
                    reasoning: "Addresses her concern directly, offers solution that gives her control."
                  },
                  {
                    text: "Understood. How about we work together on the slides? You ensure technical accuracy, I'll help frame it for the business stakeholders. We can iterate until you're comfortable with the balance.",
                    tone: "Collaborative/Specific",
                    rapportChange: 18,
                    nextNode: 'NODE_SM_32',
                    reasoning: "Joint ownership, values both skillsets."
                  }
                ]
              },
              'NODE_SM_11': {
                npcText: "*studies you for a moment* Fine. I'm willing to discuss collaboration. But understand that my team's research has intellectual property considerations and publication priorities. Any use would need to align with our academic goals, not just your project timeline.",
                status: 'pending',
                options: [
                  {
                    text: "Absolutely understood. I wouldn't want to compromise your publication plans or IP. Can you walk me through what those considerations are so I can ensure our collaboration respects them? Your academic priorities take precedence here.",
                    tone: "Understanding/Respectful",
                    rapportChange: 20,
                    nextNode: 'NODE_SM_43',
                    reasoning: "Explicitly prioritizes her needs."
                  },
                  {
                    text: "That's fair. What if we focus only on already-published findings? That way there's no IP conflict or publication timing issues.",
                    tone: "Practical/Negotiating",
                    rapportChange: 15,
                    nextNode: 'NODE_SM_44',
                    reasoning: "Offers practical solution that protects her interests."
                  }
                ]
              },
              'NODE_SM_12': {
                npcText: "*stands up, voice cold* There is no 'mandate' that gives you rights to my team's research. Academic work doesn't fall under project management authority. You'll be hearing from my department chair about this overreach. We're done here.",
                status: 'refused',
                options: [
                  {
                    text: "[Conversation ended]",
                    tone: "Terminal",
                    rapportChange: 0,
                    nextNode: 'NODE_SM_FAIL',
                    reasoning: "TERMINAL. She will actively block."
                  }
                ]
              },
              'NODE_SM_19': {
                npcText: "*leans forward, engaged* Now that's a thoughtful proposal. The board visibility would be valuableâ€”my team needs funding for Phase 2 of our research. And I appreciate that you're thinking about methodology integrity. What's your timeline, and what level of involvement are you proposing for my team?",
                status: 'warming',
                options: [
                  {
                    text: "Presentation is in two weeks. I'm proposing: you review and approve all slides featuring your work, you or a team member co-present the research section, and we include clear pathways for stakeholders to support future research phases. Time commitment would be maybe 4-6 hours total. We'd work around your schedule.",
                    tone: "Collaborative/Detailed",
                    rapportChange: 20,
                    nextNode: 'NODE_SM_65',
                    reasoning: "Specific timeline and commitment, multiple involvement levels."
                  }
                ]
              },
              'NODE_SM_21': {
                npcText: "*appreciates the honesty* Fair enough. Meaningful collaboration for me means: proper attribution, no oversimplification, involvement in how findings are presented, and ideally some benefit to my research programâ€”whether that's funding connections, case study opportunities, or publication possibilities.",
                status: 'warming',
                options: [
                  {
                    text: "I can commit to all of that. Let's structure it this way: you control how your research is presented, full attribution throughout, you or your team present that section, and I'll personally introduce you to the board members who fund research initiatives. Plus, if Project Phoenix succeeds, it could serve as a real-world case study for your algorithms. Does that work?",
                    tone: "Committed/Specific",
                    rapportChange: 20,
                    nextNode: 'NODE_SM_SUCCESS',
                    reasoning: "Addresses every point specifically. WIN CONDITION."
                  }
                ]
              },
              'NODE_SM_27': {
                npcText: "Fifteen minutes is reasonable for comprehensive coverage without oversimplification. I appreciate you asking rather than just assigning time. Yes, I'll present it myselfâ€”that ensures accuracy. When do you need my final materials?",
                status: 'agreed',
                options: [
                  {
                    text: "How about you deliver your section five days before the presentation? That gives us time for technical checks and integration, but doesn't rush your preparation. And if you need more time, just let me knowâ€”we can adjust the schedule. Sound good?",
                    tone: "Collaborative/Clear",
                    rapportChange: 12,
                    nextNode: 'NODE_SM_SUCCESS',
                    reasoning: "Reasonable timeline with buffer. WIN CONDITION."
                  }
                ]
              },
              'NODE_SM_31': {
                npcText: "That would work well. Having direct control over the presentation of our methodology addresses my primary concern. When should we schedule time to coordinate?",
                status: 'agreed',
                options: [
                  {
                    text: "Let's schedule a working session this week to align on the overall flow and your section's placement. Then you can develop your portion independently.",
                    tone: "Collaborative",
                    rapportChange: 15,
                    nextNode: 'NODE_SM_SUCCESS',
                    reasoning: "Coordinated but respects her independence. WIN CONDITION."
                  }
                ]
              },
              'NODE_SM_32': {
                npcText: "That sounds like a good collaborative approach. Let's set up time to work through the slides together.",
                status: 'agreed',
                options: [
                  {
                    text: "Perfect. I'll send a meeting invite for later this week.",
                    tone: "Professional",
                    rapportChange: 15,
                    nextNode: 'NODE_SM_SUCCESS',
                    reasoning: "Clear next steps. WIN CONDITION."
                  }
                ]
              },
              'NODE_SM_43': {
                npcText: "I appreciate that approach. Let me outline our constraints... [continues discussion leading to agreement]",
                status: 'warming',
                options: [
                  {
                    text: "Thank you for explaining. I'll make sure we work within those parameters.",
                    tone: "Respectful",
                    rapportChange: 18,
                    nextNode: 'NODE_SM_SUCCESS',
                    reasoning: "Shows willingness to work within her framework. WIN CONDITION."
                  }
                ]
              },
              'NODE_SM_44': {
                npcText: "That could work. Let me identify which published findings would be relevant. Give me a day to review.",
                status: 'warming',
                options: [
                  {
                    text: "Perfect. Thank you for considering this.",
                    tone: "Professional",
                    rapportChange: 12,
                    nextNode: 'NODE_SM_SUCCESS',
                    reasoning: "Practical solution accepted. WIN CONDITION."
                  }
                ]
              },
              'NODE_SM_65': {
                npcText: "That's a well-thought-out proposal. The timeline works, and I appreciate the clear time estimate. Yes, let's move forward with this collaboration.",
                status: 'agreed',
                options: [
                  {
                    text: "Excellent. I'll send a detailed collaboration agreement for your review.",
                    tone: "Professional",
                    rapportChange: 15,
                    nextNode: 'NODE_SM_SUCCESS',
                    reasoning: "Professional partnership established. WIN CONDITION."
                  }
                ]
              },
              'NODE_SM_SUCCESS': {
                npcText: "This is how collaboration should work. I'm looking forward to working together on this.",
                status: 'agreed',
                options: []
              },
              'NODE_SM_FAIL': {
                npcText: "*refuses all collaboration*",
                status: 'refused',
                options: []
              }
            },
            // ADMIN TREE - Mr. Robert Kim - abbreviated
            admin: {
              'NODE_RK_01': {
                npcText: "Good morning. What can I help you with?",
                status: 'pending',
                options: [
                  {
                    text: "Good morning, Mr. Kim. I'm here to submit a request for expedited equipment approval for Project Phoenix. I've completed Form 27-B and have supporting documentation regarding the business justification and timeline requirements. May I walk you through the request?",
                    tone: "Formal/Prepared",
                    rapportChange: 20,
                    nextNode: 'NODE_RK_02',
                    reasoning: "Formal tone, mentions specific form, has documentation."
                  },
                  {
                    text: "Hey Robert! I need to get some equipment approved pretty quickly. Can you help me fast-track it? It's kind of urgent.",
                    tone: "Casual/Friendly",
                    rapportChange: -18,
                    nextNode: 'NODE_RK_03',
                    reasoning: "Casual tone, vague, asks for favor, no proper procedures."
                  },
                  {
                    text: "Good morning. I need to fast-track an equipment approval for Project Phoenix. What's the process for expedited requests?",
                    tone: "Professional/Incomplete",
                    rapportChange: 5,
                    nextNode: 'NODE_RK_04',
                    reasoning: "Professional but shows up without research."
                  },
                  {
                    text: "Good morning, Mr. Kim. I appreciate you taking the time to see me. I'd like to discuss an equipment approval request and understand the proper procedure for time-sensitive requests. I want to ensure I follow all appropriate protocols.",
                    tone: "Formal/Respectful",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_06',
                    reasoning: "Formal, respectful, emphasizes following protocols."
                  }
                ]
              },
              'NODE_RK_02': {
                npcText: "Form 27-B, good. You've done your homework. *adjusts glasses* What's the specific equipment, what's the business justification, and why do you need expedited processing rather than standard 30-day approval?",
                status: 'warming',
                options: [
                  {
                    text: "Specialized data processing equipment, model number SPX-4400, vendor is TechCore Systems. Business justification: critical path dependency for Project Phoenix launch, which has board-level visibility and contractual delivery obligations. Expedited processing is needed because standard timeline would delay project launch by three weeks, resulting in contractual penalties estimated at $78,000. I have supporting documentation including project timeline, vendor quotes, and budget approval.",
                    tone: "Detailed/Organized",
                    rapportChange: 25,
                    nextNode: 'NODE_RK_07',
                    reasoning: "Extremely specific with model numbers, exact costs, comprehensive documentation."
                  },
                  {
                    text: "Data processing equipment for Project Phoenix. It's on the critical path and standard approval timeline would cause significant project delays. We have budget approval and the vendor is ready to deliver once we have procurement authorization.",
                    tone: "Professional/Clear",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_08',
                    reasoning: "Clear but less detailed."
                  }
                ]
              },
              'NODE_RK_03': {
                npcText: "It's Mr. Kim, not Robert. And 'kind of urgent' isn't a processing category. Expedited requests require Form 27-B, proper documentation, and legitimate business justification. Do you have those materials prepared?",
                status: 'cooling',
                options: [
                  {
                    text: "My apologies, Mr. Kim. I should have been more professional. Yes, I have Form 27-B completed and all supporting documentation. May I present the formal request properly?",
                    tone: "Recovery/Formal",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_11',
                    reasoning: "Immediate apology, corrects tone, shows preparation."
                  },
                  {
                    text: "Oh, sorry... I didn't realize I needed a specific form. Where can I get Form 27-B?",
                    tone: "Embarrassed/Unprepared",
                    rapportChange: -20,
                    nextNode: 'NODE_RK_12',
                    reasoning: "CRITICAL NEGATIVE. Showed up without basic research."
                  }
                ]
              },
              'NODE_RK_04': {
                npcText: "The process is outlined in the Procurement Manual, Section 4.3. It requires Form 27-B, supporting documentation, and clear justification for why standard processing is insufficient. Have you reviewed the manual?",
                status: 'pending',
                options: [
                  {
                    text: "I haven't yet, and I should have before taking your time. May I review Section 4.3 and return with a properly prepared request? I want to do this correctly.",
                    tone: "Honest/Respectful",
                    rapportChange: 12,
                    nextNode: 'NODE_RK_15',
                    reasoning: "Acknowledges mistake, respects his time."
                  },
                  {
                    text: "I've reviewed the section. I'm here to submit Form 27-B and discuss whether my justification meets the criteria for expedited processing. May I present the request?",
                    tone: "Professional/Prepared",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_18',
                    reasoning: "Actually did homework. Good recovery."
                  }
                ]
              },
              'NODE_RK_06': {
                npcText: "I appreciate that you're asking about proper procedure. For time-sensitive requests, you'll need to complete Form 27-B with supporting documentation including budget approval, business justification, and project timeline. The criteria for expedited processing are outlined in Procurement Manual Section 4.3. Do you have these materials prepared?",
                status: 'warming',
                options: [
                  {
                    text: "Yes, I do. I have Form 27-B completed, budget approval from Finance, detailed business justification with quantified impact of delays, and the full project timeline showing critical path dependencies. I've also reviewed Section 4.3 and believe this request meets criteria 2 and 4 for expedited processing. May I walk you through the submission?",
                    tone: "Prepared/Thorough",
                    rapportChange: 22,
                    nextNode: 'NODE_RK_23',
                    reasoning: "Has everything, cites specific criteria. Extremely well-prepared."
                  }
                ]
              },
              'NODE_RK_07': {
                npcText: "*nods approvingly, takes notes* This is a properly prepared request. You have specific equipment identification, quantified business impact, and legitimate justification for expedited processing. Let me review the documentation. The $78,000 contractual penalty provides clear business justification. However, expedited processing still requires approval chain review. What's your required delivery date?",
                status: 'warming',
                options: [
                  {
                    text: "Equipment needs to be operational by December 1st to maintain the critical path. That requires procurement authorization by November 22ndâ€”ten days from now. Standard processing takes 30 days, which creates a 20-day gap. I've confirmed with the vendor they can deliver within 5 business days of authorized purchase order.",
                    tone: "Specific/Realistic",
                    rapportChange: 20,
                    nextNode: 'NODE_RK_27',
                    reasoning: "Specific dates, shows math, includes vendor confirmation."
                  }
                ]
              },
              'NODE_RK_08': {
                npcText: "That's adequate justification. I'll need to see the specific documentationâ€”budget approval, vendor information, and project timeline with critical path notation. Do you have those materials with you?",
                status: 'warming',
                options: [
                  {
                    text: "Yes, all here. *presents organized folder* Budget approval is on top with Finance signature, followed by vendor quote with delivery terms, then project timeline with critical path highlighted. Everything is tab-separated for easy review.",
                    tone: "Prepared/Organized",
                    rapportChange: 20,
                    nextNode: 'NODE_RK_31',
                    reasoning: "Has everything organized professionally."
                  }
                ]
              },
              'NODE_RK_11': {
                npcText: "Very well. Let's see the documentation. Walk me through your Form 27-B submission.",
                status: 'pending',
                options: [
                  {
                    text: "Form 27-B, Section 1: Equipment specificationâ€”SPX-4400 processing system. Section 2: Business justificationâ€”critical path dependency with quantified penalty risk. Section 3: Budget approvalâ€”attached with Finance signature dated November 10th. Section 4: Expedited justificationâ€”contractual obligation timeline. Supporting documentation includes vendor quotes, project timeline, and penalty clause from client contract.",
                    tone: "Organized/Professional",
                    rapportChange: 20,
                    nextNode: 'NODE_RK_42',
                    reasoning: "Walks through section by section. Good recovery continues."
                  }
                ]
              },
              'NODE_RK_12': {
                npcText: "*expression hardens* Form 27-B is available on the department website, which you should have checked before requesting my time. Expedited requests require preparation, not improvisation. Please complete the proper forms and submit through official channels. This meeting is over.",
                status: 'cooling',
                options: [
                  {
                    text: "You're absolutely right, Mr. Kim. I wasted your time by not preparing properly. May I return tomorrow with all materials correctly prepared? I'll review the manual and complete all required documentation.",
                    tone: "Apologetic/Learning",
                    rapportChange: 12,
                    nextNode: 'NODE_RK_45',
                    reasoning: "Takes full responsibility. Long-shot recovery."
                  }
                ]
              },
              'NODE_RK_15': {
                npcText: "I appreciate that you're willing to do it correctly. Yes, review Section 4.3 carefullyâ€”it details all requirements. The department website also has a checklist and sample completed forms. Come back when you're fully prepared.",
                status: 'warming',
                options: [
                  {
                    text: "Thank you, Mr. Kim. I'll review the section thoroughly, complete the checklist, and return with everything properly documented. Would tomorrow afternoon work for resubmission, or is there a preferred submission time?",
                    tone: "Appreciative/Organized",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_54',
                    reasoning: "Thanks him, uses all resources, asks about preferences."
                  }
                ]
              },
              'NODE_RK_18': {
                npcText: "Good. Let's review your submission then. What's the specific equipment and business justification?",
                status: 'warming',
                options: [
                  {
                    text: "SPX-4400 data processing system from TechCore Systems, cost $45,000. Business justification: Project Phoenix has contractual delivery obligation of January 15th. This equipment is on critical pathâ€”standard 30-day approval creates 20-day delay, causing breach of contract with $78,000 penalty per Section 7.2 of client agreement. Budget is approved, vendor can deliver in 5 days, and expedited processing satisfies criteria 2 and 4 in Section 4.3.",
                    tone: "Detailed/Organized",
                    rapportChange: 25,
                    nextNode: 'NODE_RK_62',
                    reasoning: "Comprehensive, specific, quantified, cites sections."
                  }
                ]
              },
              'NODE_RK_23': {
                npcText: "*visibly impressed* Section 4.3â€”good. You've read the manual. That's rare. Let me review your documentation. If everything is in order and meets the criteria, I can initiate expedited processing. However, you should know that even expedited approval takes 10-12 business days minimum. Is that acceptable for your timeline?",
                status: 'warming',
                options: [
                  {
                    text: "That's tight but workable. Our critical deadline is December 1st, which is 15 business days away. If expedited processing is 10-12 days, that leaves minimal buffer. Are there any additional steps I can take to ensure smooth processing, such as preemptive coordination with the approval chain or having all reviewers on notice?",
                    tone: "Realistic/Problem-solving",
                    rapportChange: 18,
                    nextNode: 'NODE_RK_38',
                    reasoning: "Does the math, asks about proper additional steps."
                  },
                  {
                    text: "That's workable. To ensure we stay within that timeframe, what are the common delays I should proactively address? I want to make sure nothing in my submission causes processing slowdowns.",
                    tone: "Practical/Planning",
                    rapportChange: 20,
                    nextNode: 'NODE_RK_41',
                    reasoning: "Accepts timeline, asks how to prevent delays. Excellent."
                  }
                ]
              },
              'NODE_RK_27': {
                npcText: "December 1st operational, procurement by November 22nd, vendor confirmation documentedâ€”this is exactly the level of planning I need to see. Your timeline is realistic and you've accounted for all steps. I'll initiate expedited processing today. You should expect approval within 10 business days, which meets your November 22nd requirement with two days buffer.",
                status: 'agreed',
                options: [
                  {
                    text: "Thank you, Mr. Kim. I appreciate your efficiency and your thorough review. If any questions arise during the approval process, I'm available immediately to provide additional information. Should I follow up with you, or will you notify me when approval is complete?",
                    tone: "Professional/Appreciative",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_SUCCESS',
                    reasoning: "Thanks him, offers support, asks about protocol. WIN CONDITION."
                  }
                ]
              },
              'NODE_RK_31': {
                npcText: "*reviews organized materials approvingly* Tab-separated, chronological order, all signatures present. This is proper preparation. Let me review the business justification details... Yes, this meets criteria for expedited processing. I'll begin routing this through the approval chain today.",
                status: 'agreed',
                options: [
                  {
                    text: "Thank you, Mr. Kim. Is there anything else you need from me to facilitate the approval process? I want to ensure smooth processing.",
                    tone: "Professional/Supportive",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_SUCCESS',
                    reasoning: "Thanks him, offers additional support. WIN CONDITION."
                  }
                ]
              },
              'NODE_RK_38': {
                npcText: "That's good planning. I can send advance notice to the approval chain to prioritize review. Make sure you're available to answer questions if they ariseâ€”delays often happen when submitters are unreachable.",
                status: 'agreed',
                options: [
                  {
                    text: "Understood. I'll make myself available and responsive throughout the process. Thank you for the guidance.",
                    tone: "Professional",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_SUCCESS',
                    reasoning: "Commits to availability. WIN CONDITION."
                  }
                ]
              },
              'NODE_RK_41': {
                npcText: "Common delays include incomplete budget signatures, unreachable submitters, and vendor information that doesn't match our approved vendor list. You've addressed the first two. Make sure your vendor is on our approved list.",
                status: 'agreed',
                options: [
                  {
                    text: "I've verified TechCore Systems is on the approved vendor listâ€”reference number AV-2847. Thank you for the guidance.",
                    tone: "Thorough",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_SUCCESS',
                    reasoning: "Shows he checked this detail. WIN CONDITION."
                  }
                ]
              },
              'NODE_RK_42': {
                npcText: "Thorough walkthrough. I see everything is in order. I'll process this expedited request. You should receive approval notification within the standard 10-12 business day expedited timeframe.",
                status: 'agreed',
                options: [
                  {
                    text: "Thank you, Mr. Kim. I appreciate your time and thoroughness.",
                    tone: "Professional",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_SUCCESS',
                    reasoning: "Professional close after recovery. WIN CONDITION."
                  }
                ]
              },
              'NODE_RK_45': {
                npcText: "Very well. I expect to see proper preparation next time. Come back when you're ready.",
                status: 'pending',
                options: [
                  {
                    text: "I will. Thank you for the guidance. *returns next day with everything prepared*",
                    tone: "Learning",
                    rapportChange: 10,
                    nextNode: 'NODE_RK_SUCCESS',
                    reasoning: "Can eventually succeed after learning from mistake."
                  }
                ]
              },
              'NODE_RK_54': {
                npcText: "Tomorrow afternoon is fine. Office hours are 2-4 PM for submissions.",
                status: 'warming',
                options: [
                  {
                    text: "Perfect. I'll be here at 2 PM with everything completed. Thank you.",
                    tone: "Organized",
                    rapportChange: 12,
                    nextNode: 'NODE_RK_SUCCESS',
                    reasoning: "Shows organization and follow-through. WIN CONDITION."
                  }
                ]
              },
              'NODE_RK_62': {
                npcText: "This is exemplary documentation and justification. You've provided everything needed for expedited approval. I'm processing this immediately.",
                status: 'agreed',
                options: [
                  {
                    text: "Thank you, Mr. Kim. I appreciate your help and your clear procedural guidance.",
                    tone: "Professional",
                    rapportChange: 15,
                    nextNode: 'NODE_RK_SUCCESS',
                    reasoning: "Professional appreciation. WIN CONDITION."
                  }
                ]
              },
              'NODE_RK_SUCCESS': {
                npcText: "I'll begin expedited processing immediately. You should receive approval notification within 10 business days. If any issues arise during routing, I'll contact you directly. This is how the process should work.",
                status: 'agreed',
                options: []
              },
              'NODE_RK_FAIL': {
                npcText: "This request is denied due to improper process and inadequate documentation. Resubmit through proper channels when you're prepared to follow institutional procedures.",
                status: 'refused',
                options: []
              }
            }
          };

          const scenario = {
            title: "Project Phoenix - Cross-Departmental Coordination",
            description: "You're managing Project Phoenix, a critical initiative launching next week. You need cooperation from four key people, each with different working styles and communication preferences. Your goal: get all four to commit to their tasks through effective written communication.",
            objective: "Get all 4 people to agree to complete their tasks"
          };

          const startGame = () => {
            setGameState('playing');
          };

          const selectNPC = (npcId) => {
            setCurrentNPC(npcId);
          };

          const backToHub = () => {
            setCurrentNPC(null);
          };

          const selectOption = (option) => {
            const npc = npcs[currentNPC];
            const currentNode = conversationTrees[npc.treeKey][currentNodes[currentNPC]];
            
            // Add user message to conversation
            const userMessage = option.text;
            const newConversations = {
              ...conversations,
              [currentNPC]: [...conversations[currentNPC], { sender: 'user', text: userMessage, tone: option.tone }]
            };
            
            // Update rapport
            const newRapport = Math.max(-100, Math.min(100, npcRapport[currentNPC] + option.rapportChange));
            setNpcRapport({
              ...npcRapport,
              [currentNPC]: newRapport
            });
            
            // Track path taken
            const newPaths = {
              ...pathsTaken,
              [currentNPC]: [...pathsTaken[currentNPC], {
                node: currentNodes[currentNPC],
                option: option.text,
                tone: option.tone,
                rapportChange: option.rapportChange,
                reasoning: option.reasoning
              }]
            };
            setPathsTaken(newPaths);
            
            // Get next node
            const nextNodeId = option.nextNode;
            const nextNode = conversationTrees[npc.treeKey][nextNodeId];
            
            // Add NPC response
            newConversations[currentNPC].push({
              sender: 'npc',
              text: nextNode.npcText
            });
            
            setConversations(newConversations);
            
            // Update current node
            setCurrentNodes({
              ...currentNodes,
              [currentNPC]: nextNodeId
            });
            
            // Update status if terminal node
            if (nextNode.status === 'agreed') {
              setNpcStatus({
                ...npcStatus,
                [currentNPC]: 'agreed'
              });
            } else if (nextNode.status === 'refused') {
              setNpcStatus({
                ...npcStatus,
                [currentNPC]: 'refused'
              });
            }
          };

          const generateFeedback = () => {
            const feedback = {
              npc_feedback: {},
              overall_assessment: {
                success_rate: `${Object.values(npcStatus).filter(s => s === 'agreed').length}/4`,
                achieved_goal: Object.values(npcStatus).filter(s => s === 'agreed').length === 4,
                summary: ""
              },
              key_lessons: []
            };

            // Generate feedback for each contacted NPC
            Object.keys(pathsTaken).forEach(npcId => {
              if (pathsTaken[npcId].length === 0) return;
              
              const npc = npcs[npcId];
              const paths = pathsTaken[npcId];
              const finalStatus = npcStatus[npcId];
              const finalRapport = npcRapport[npcId];
              
              // Analyze tone consistency
              const tones = paths.map(p => p.tone);
              const primaryTone = tones[0].split('/')[0];
              
              // Determine effectiveness
              let effectiveness = 'ineffective';
              if (finalStatus === 'agreed') {
                effectiveness = finalRapport > 50 ? 'effective' : 'partially effective';
              }
              
              // Extract key phrases
              const examples = paths.slice(0, 2).map(p => p.option.substring(0, 100));
              
              // Generate analysis
              let analysis = '';
              if (finalStatus === 'agreed') {
                analysis = `Your approach was successful. You ${paths.length > 2 ? 'adapted well' : 'started strong'} and maintained ${primaryTone.toLowerCase()} communication that resonated with ${npc.name}'s ${npc.mbti} personality. `;
              } else if (finalStatus === 'refused') {
                analysis = `Your approach triggered ${npc.name}'s critical flaw. The conversation ended when you ${paths[paths.length - 1].reasoning.toLowerCase()}`;
              } else {
                analysis = `You made progress but didn't reach a commitment. Your tone was ${primaryTone.toLowerCase()} which partially aligned with their needs for ${npc.communicationStyle.split('.')[0].toLowerCase()}.`;
              }
              
              // Generate suggestions
              let suggestions = '';
              if (npc.mbti === 'ENTJ') {
                suggestions = effectiveness === 'effective' ? 
                  "You correctly used data-driven, confident language. Great job!" :
                  "Remember: ENTJs respect confidence, specific numbers, and strategic thinking. Avoid hedging language and lead with concrete data.";
              } else if (npc.mbti === 'ISFJ') {
                suggestions = effectiveness === 'effective' ?
                  "Excellent use of warmth and collaborative language!" :
                  "ISFJs need warmth, clear guidance, and reassurance. Use 'we' language and avoid harsh criticism or pressure.";
              } else if (npc.mbti === 'INTJ') {
                suggestions = effectiveness === 'effective' ?
                  "You successfully respected their expertise and autonomy!" :
                  "INTJs need diplomatic, collaborative language. Respect their expertise, discuss proper attribution, and frame as partnership not extraction.";
              } else if (npc.mbti === 'ISTJ') {
                suggestions = effectiveness === 'effective' ?
                  "Perfect use of formal language and attention to process!" :
                  "ISTJs require formal communication, proper documentation, and respect for procedures. Always research requirements first and cite specific policies.";
              }
              
              feedback.npc_feedback[npcId] = {
                npc_name: npc.name,
                tone_used: primaryTone,
                personality_match: `Your ${primaryTone.toLowerCase()} approach ${effectiveness === 'effective' ? 'matched well' : 'partially matched'} with their ${npc.mbti} preference for ${npc.communicationStyle.split('.')[0].toLowerCase()}.`,
                strategic_approach: paths.length > 1 ? 
                  "You showed some adaptation as the conversation progressed." :
                  "You maintained a consistent approach throughout.",
                effectiveness: effectiveness,
                analysis: analysis,
                examples: examples,
                suggestions: suggestions
              };
            });

            // Overall assessment
            const agreedCount = Object.values(npcStatus).filter(s => s === 'agreed').length;
            feedback.overall_assessment.summary = agreedCount === 4 ?
              "Excellent work! You successfully adapted your communication style to each personality type and achieved all your objectives." :
              agreedCount >= 2 ?
              `Good effort! You succeeded with ${agreedCount} out of 4 people. Review the feedback to see how tone and approach affected different personality types.` :
              "You struggled to connect with most team members. Focus on understanding each personality type's communication preferences and adapting your approach accordingly.";

            // Key lessons
            feedback.key_lessons = [
              "Different personality types require different communication approaches. What works for an ENTJ (direct, data-driven) won't work for an ISFJ (warm, collaborative).",
              "Tone matters as much as content. The same request can succeed or fail based purely on how it's delivered.",
              `${agreedCount >= 3 ? 'You showed good adaptability' : 'Practice adapting your style'} to match each person's preferences rather than using a one-size-fits-all approach.`
            ];

            return feedback;
          };

          const endGame = () => {
            const feedback = generateFeedback();
            setFeedback(feedback);
            setGameState('feedback');
          };

          const restartGame = () => {
            setGameState('intro');
            setCurrentNPC(null);
            setCurrentNodes({
              client: 'NODE_PC_01',
              intern: 'NODE_JP_01',
              colleague: 'NODE_SM_01',
              admin: 'NODE_RK_01'
            });
            setConversations({
              client: [],
              intern: [],
              colleague: [],
              admin: []
            });
            setNpcStatus({
              client: 'pending',
              intern: 'pending',
              colleague: 'pending',
              admin: 'pending'
            });
            setNpcRapport({
              client: 0,
              intern: 0,
              colleague: 0,
              admin: 0
            });
            setPathsTaken({
              client: [],
              intern: [],
              colleague: [],
              admin: []
            });
            setFeedback(null);
          };

          // Intro Screen
          if (gameState === 'intro') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                <div className="max-w-3xl mx-auto bg-white rounded-lg shadow-xl p-8">
                  <div className="text-center mb-8">
                    <h1 className="text-4xl font-bold text-indigo-900 mb-2">{scenario.title}</h1>
                    <p className="text-gray-600">A Tone & Persuasion Communication Game</p>
                  </div>

                  <div className="bg-indigo-50 border-l-4 border-indigo-500 p-6 mb-6">
                    <h2 className="text-xl font-semibold text-indigo-900 mb-3">Scenario</h2>
                    <p className="text-gray-700 mb-4">{scenario.description}</p>
                    <div className="bg-white p-4 rounded">
                      <p className="font-semibold text-indigo-800">ðŸŽ¯ Your Goal:</p>
                      <p className="text-gray-700">{scenario.objective}</p>
                    </div>
                  </div>

                  <div className="mb-6">
                    <h3 className="text-lg font-semibold text-gray-800 mb-4">The Team:</h3>
                    <div className="grid grid-cols-1 gap-4">
                      {Object.entries(npcs).map(([id, npc]) => (
                        <div key={id} className="bg-gray-50 p-4 rounded-lg border border-gray-200">
                          <div className="flex items-center gap-3 mb-3">
                            <span className="text-3xl">{npc.avatar}</span>
                            <div className="flex-1">
                              <div className="flex items-center gap-2">
                                <p className="font-semibold text-gray-800">{npc.name}</p>
                                <span className="text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded">{npc.mbti}</span>
                              </div>
                              <p className="text-sm text-gray-600">{npc.role}</p>
                            </div>
                          </div>
                          <div className="space-y-1 text-sm">
                            <p className="text-gray-700">
                              <span className="font-medium">Task:</span> {npc.task}
                            </p>
                            <p className="text-gray-600 italic">
                              {npc.communicationStyle.split('.')[0]}.
                            </p>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                    <p className="text-sm text-gray-700">
                      <strong>Note:</strong> Choose your responses carefully - each person responds differently to different tones and approaches. You'll receive detailed feedback at the end.
                    </p>
                  </div>

                  <button
                    onClick={startGame}
                    className="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                  >
                    Start Game
                  </button>
                </div>
              </div>
            );
          }

          // Playing - Hub View
          if (gameState === 'playing' && !currentNPC) {
            const agreedCount = Object.values(npcStatus).filter(s => s === 'agreed').length;
            const hasConversations = Object.values(conversations).some(conv => conv.length > 0);

            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className="bg-white rounded-lg shadow-xl p-6 mb-6">
                    <div className="flex justify-between items-center">
                      <div>
                        <h2 className="text-2xl font-bold text-indigo-900">Project Phoenix Control Center</h2>
                        <p className="text-gray-600">Select a team member to contact</p>
                      </div>
                      <div className="text-right">
                        <div className="text-3xl font-bold text-indigo-600">{agreedCount}/4</div>
                        <p className="text-sm text-gray-600">Committed</p>
                      </div>
                    </div>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    {Object.entries(npcs).map(([id, npc]) => {
                      const status = npcStatus[id];
                      const messageCount = conversations[id].length;
                      
                      return (
                        <button
                          key={id}
                          onClick={() => selectNPC(id)}
                          className={`bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-all text-left ${
                            status === 'agreed' ? 'border-2 border-green-500' : 
                            status === 'refused' ? 'border-2 border-red-500' : 
                            'border-2 border-gray-200'
                          }`}
                        >
                          <div className="flex items-start justify-between mb-3">
                            <div className="flex items-center gap-3">
                              <span className="text-4xl">{npc.avatar}</span>
                              <div>
                                <p className="font-bold text-gray-800">{npc.name}</p>
                                <p className="text-sm text-gray-600">{npc.role}</p>
                              </div>
                            </div>
                            {status === 'agreed' && <span className="text-2xl">âœ…</span>}
                            {status === 'refused' && <span className="text-2xl">âŒ</span>}
                          </div>
                          
                          <p className="text-sm text-gray-700 mb-3">{npc.task}</p>
                          
                          <div className="flex items-center gap-2 text-xs text-gray-500">
                            <span>ðŸ’¬</span>
                            <span>{messageCount} message{messageCount !== 1 ? 's' : ''}</span>
                          </div>
                        </button>
                      );
                    })}
                  </div>

                  {hasConversations && (
                    <button
                      onClick={endGame}
                      className="w-full bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors"
                    >
                      End Game & See Feedback
                    </button>
                  )}
                </div>
              </div>
            );
          }

          // Playing - Conversation View
          if (gameState === 'playing' && currentNPC) {
            const npc = npcs[currentNPC];
            const conv = conversations[currentNPC];
            const status = npcStatus[currentNPC];
            const currentNode = conversationTrees[npc.treeKey][currentNodes[currentNPC]];
            const hasOptions = currentNode.options && currentNode.options.length > 0;

            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                <div className="max-w-3xl mx-auto">
                  <div className="bg-white rounded-lg shadow-xl overflow-hidden">
                    <div className="bg-indigo-600 text-white p-6">
                      <button
                        onClick={backToHub}
                        className="text-sm mb-4 hover:underline"
                      >
                        â† Back to Team
                      </button>
                      <div className="flex items-center gap-4">
                        <span className="text-5xl">{npc.avatar}</span>
                        <div className="flex-1">
                          <h2 className="text-2xl font-bold">{npc.name}</h2>
                          <p className="text-indigo-100">{npc.role}</p>
                          <p className="text-sm text-indigo-200 mt-1">Task: {npc.task}</p>
                          
                          <div className="mt-2">
                            <div className="flex items-center gap-2">
                              <span className="text-xs text-indigo-200">Relationship:</span>
                              <div className="flex-1 bg-indigo-800 rounded-full h-2 max-w-[200px]">
                                <div 
                                  className={`h-2 rounded-full transition-all duration-500 ${
                                    npcRapport[currentNPC] > 50 ? 'bg-green-400' :
                                    npcRapport[currentNPC] > 0 ? 'bg-yellow-400' :
                                    npcRapport[currentNPC] > -50 ? 'bg-orange-400' :
                                    'bg-red-400'
                                  }`}
                                  style={{ width: `${Math.max(0, (npcRapport[currentNPC] + 100) / 2)}%` }}
                                ></div>
                              </div>
                              <span className="text-xs text-indigo-200">
                                {npcRapport[currentNPC] > 50 ? 'ðŸ˜Š' :
                                 npcRapport[currentNPC] > 0 ? 'ðŸ™‚' :
                                 npcRapport[currentNPC] > -50 ? 'ðŸ˜' :
                                 'ðŸ˜ '}
                              </span>
                            </div>
                          </div>
                        </div>
                      </div>
                      {status === 'agreed' && (
                        <div className="mt-3 bg-green-500 text-white px-3 py-1 rounded inline-block text-sm">
                          âœ“ Committed to task
                        </div>
                      )}
                      {status === 'refused' && (
                        <div className="mt-3 bg-red-500 text-white px-3 py-1 rounded inline-block text-sm">
                          âœ— Declined task
                        </div>
                      )}
                    </div>

                    <div className="p-6 h-96 overflow-y-auto bg-gray-50">
                      {conv.length === 0 ? (
                        <div className="text-center text-gray-400 mt-20">
                          <span className="text-5xl block mb-4">ðŸ’¬</span>
                          <p>Start the conversation by choosing a response...</p>
                        </div>
                      ) : (
                        <div className="space-y-4">
                          {conv.map((msg, idx) => (
                            <div
                              key={idx}
                              className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}
                            >
                              <div
                                className={`max-w-[80%] p-4 rounded-lg ${
                                  msg.sender === 'user'
                                    ? 'bg-indigo-600 text-white'
                                    : 'bg-white text-gray-800 shadow'
                                }`}
                              >
                                <p className="text-sm font-semibold mb-1">
                                  {msg.sender === 'user' ? 'You' : npc.name}
                                </p>
                                {msg.tone && (
                                  <p className="text-xs opacity-75 mb-2 italic">[{msg.tone}]</p>
                                )}
                                <p>{msg.text}</p>
                              </div>
                            </div>
                          ))}
                        </div>
                      )}
                    </div>

                    <div className="p-6 bg-white border-t border-gray-200">
                      {hasOptions ? (
                        <div className="space-y-3">
                          <p className="text-sm font-semibold text-gray-700 mb-3">Choose your response:</p>
                          {currentNode.options.map((option, idx) => (
                            <button
                              key={idx}
                              onClick={() => selectOption(option)}
                              className="w-full text-left p-4 bg-gray-50 hover:bg-indigo-50 border border-gray-200 hover:border-indigo-300 rounded-lg transition-colors"
                            >
                              <p className="text-xs font-semibold text-indigo-600 mb-1">[{option.tone}]</p>
                              <p className="text-sm text-gray-800">{option.text}</p>
                            </button>
                          ))}
                        </div>
                      ) : (
                        <div className="text-center text-gray-600">
                          <p className="mb-4">This conversation has ended.</p>
                          <button
                            onClick={backToHub}
                            className="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700"
                          >
                            Return to Team Hub
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          // Feedback Screen
          if (gameState === 'feedback') {
            const agreedCount = Object.values(npcStatus).filter(s => s === 'agreed').length;
            const goalAchieved = agreedCount === 4;

            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
                <div className="max-w-4xl mx-auto">
                  <div className={`bg-white rounded-lg shadow-xl p-8 mb-6 border-4 ${
                    goalAchieved ? 'border-green-500' : 'border-yellow-500'
                  }`}>
                    <div className="text-center">
                      <span className="text-6xl block mb-4">{goalAchieved ? 'ðŸ†' : 'ðŸ“Š'}</span>
                      <h1 className="text-3xl font-bold text-gray-800 mb-2">
                        {goalAchieved ? 'ðŸŽ‰ Mission Accomplished!' : 'ðŸ“Š Game Complete'}
                      </h1>
                      <p className="text-xl text-gray-600 mb-4">
                        {feedback.overall_assessment?.success_rate || `${agreedCount}/4`} team members committed
                      </p>
                      <p className="text-gray-700">
                        {feedback.overall_assessment?.summary || 'Review your feedback below.'}
                      </p>
                    </div>
                  </div>

                  <div className="space-y-6 mb-6">
                    <h2 className="text-2xl font-bold text-gray-800">Communication Analysis</h2>
                    
                    {feedback.npc_feedback && Object.entries(feedback.npc_feedback).map(([npcId, npcFeedback]) => (
                      <div key={npcId} className="bg-white rounded-lg shadow-lg p-6">
                        <div className="flex items-center gap-3 mb-4">
                          <span className="text-3xl">{npcs[npcId]?.avatar || 'ðŸ‘¤'}</span>
                          <div className="flex-1">
                            <div className="flex items-center gap-2">
                              <h3 className="text-xl font-bold text-gray-800">{npcFeedback.npc_name}</h3>
                              <span className={`text-sm px-3 py-1 rounded-full ${
                                npcFeedback.effectiveness === 'effective' ? 'bg-green-100 text-green-800' :
                                npcFeedback.effectiveness === 'partially effective' ? 'bg-yellow-100 text-yellow-800' :
                                'bg-red-100 text-red-800'
                              }`}>
                                {npcFeedback.effectiveness}
                              </span>
                            </div>
                            <div className="flex items-center gap-2 mt-1">
                              <span className="text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded">
                                {npcs[npcId]?.mbti}
                              </span>
                              <span className="text-xs text-gray-500">
                                Final Rapport: {npcRapport[npcId]}/100
                              </span>
                            </div>
                          </div>
                        </div>

                        <div className="space-y-3">
                          <div>
                            <p className="font-semibold text-gray-700">Tone Used:</p>
                            <p className="text-gray-600">{npcFeedback.tone_used}</p>
                          </div>

                          {npcFeedback.personality_match && (
                            <div>
                              <p className="font-semibold text-gray-700">Personality Match:</p>
                              <p className="text-gray-600">{npcFeedback.personality_match}</p>
                            </div>
                          )}

                          <div>
                            <p className="font-semibold text-gray-700">Analysis:</p>
                            <p className="text-gray-600">{npcFeedback.analysis}</p>
                          </div>

                          {npcFeedback.examples && npcFeedback.examples.length > 0 && (
                            <div>
                              <p className="font-semibold text-gray-700">Example Phrases:</p>
                              <ul className="list-disc list-inside text-gray-600 ml-2">
                                {npcFeedback.examples.map((example, idx) => (
                                  <li key={idx} className="italic text-sm">"{example}..."</li>
                                ))}
                              </ul>
                            </div>
                          )}

                          <div>
                            <p className="font-semibold text-gray-700">How to Improve:</p>
                            <p className="text-gray-600">{npcFeedback.suggestions}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  {feedback.key_lessons && feedback.key_lessons.length > 0 && (
                    <div className="bg-indigo-50 rounded-lg shadow-lg p-6 mb-6">
                      <h2 className="text-xl font-bold text-indigo-900 mb-4">ðŸ“š Key Lessons</h2>
                      <ul className="space-y-2">
                        {feedback.key_lessons.map((lesson, idx) => (
                          <li key={idx} className="flex gap-3">
                            <span className="text-indigo-600 font-bold">{idx + 1}.</span>
                            <span className="text-gray-700">{lesson}</span>
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}

                  <button
                    onClick={restartGame}
                    className="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition-colors"
                  >
                    Play Again
                  </button>
                </div>
              </div>
            );
          }

          return null;
        };

        ReactDOM.render(<TonePersuasionGame />, document.getElementById('root'));
    </script>
</body>
</html>
